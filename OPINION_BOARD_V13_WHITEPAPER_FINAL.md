# ì˜ê²¬ ë³´ë“œ ì‹œìŠ¤í…œ v1.3 ìµœì¢… ê°œë°œ ë°±ì„œ
## CUCKOO ì œí’ˆ ì§„ì²™ë¥  ê´€ë¦¬ ì‹œìŠ¤í…œ (Supabase ì „ìš© ë²„ì „)

---

## ğŸ“‹ ëª©ì°¨

1. [í”„ë¡œì íŠ¸ ê°œìš”](#í”„ë¡œì íŠ¸-ê°œìš”)
2. [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
3. [ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„](#ë°ì´í„°ë² ì´ìŠ¤-ì„¤ê³„)
4. [í˜ì´ì§€ êµ¬ì¡° ë° ë¼ìš°íŒ…](#í˜ì´ì§€-êµ¬ì¡°-ë°-ë¼ìš°íŒ…)
5. [UI/UX ì»´í¬ë„ŒíŠ¸ ì‹œìŠ¤í…œ](#uiux-ì»´í¬ë„ŒíŠ¸-ì‹œìŠ¤í…œ)
6. [ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§](#ë¹„ì¦ˆë‹ˆìŠ¤-ë¡œì§)
7. [ì¸ì¦ ë° ê¶Œí•œ ì‹œìŠ¤í…œ](#ì¸ì¦-ë°-ê¶Œí•œ-ì‹œìŠ¤í…œ)
8. [ì‹¤ì‹œê°„ ê¸°ëŠ¥](#ì‹¤ì‹œê°„-ê¸°ëŠ¥)
9. [ì„±ëŠ¥ ìµœì í™”](#ì„±ëŠ¥-ìµœì í™”)
10. [ë³´ì•ˆ ì‹œìŠ¤í…œ](#ë³´ì•ˆ-ì‹œìŠ¤í…œ)
11. [ì˜¤í”„ë¼ì¸ ì§€ì›](#ì˜¤í”„ë¼ì¸-ì§€ì›)
12. [ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…](#ëª¨ë‹ˆí„°ë§-ë°-ë¡œê¹…)
13. [ê¸°ìˆ  ìŠ¤íƒ](#ê¸°ìˆ -ìŠ¤íƒ)
14. [ê°œë°œ ê°€ì´ë“œë¼ì¸](#ê°œë°œ-ê°€ì´ë“œë¼ì¸)
15. [ë°°í¬ ë° ìš´ì˜](#ë°°í¬-ë°-ìš´ì˜)

---

## ğŸ¯ í”„ë¡œì íŠ¸ ê°œìš”

### ì‹œìŠ¤í…œ ëª©ì 
CUCKOO íŠ¹í™”ëœ **3ë‹¨ê³„ ì œí’ˆ ê°œë°œ ì§„ì²™ë¥  ê´€ë¦¬ ì‹œìŠ¤í…œ**ìœ¼ë¡œ, ì¿ ì¿  ê³ ê°ë§Œì¡±íŒ€ì˜ ì‹¤ì œ ì—…ë¬´ í”„ë¡œì„¸ìŠ¤ë¥¼ ë””ì§€í„¸í™”í•œ ì™„ì „í•œ í´ë¼ìš°ë“œ ê¸°ë°˜ ê´€ë¦¬ ë„êµ¬ì…ë‹ˆë‹¤.

### í•µì‹¬ íŠ¹ì§•
- **í•œêµ­ì–´ UI**: ëª¨ë“  ì¸í„°í˜ì´ìŠ¤ê°€ í•œêµ­ì–´ë¡œ êµ¬ì„±
- **ì œì¡°ì—… í”„ë¡œì„¸ìŠ¤**: ì‹¤ì œ ì œì¡°ì—… ì›Œí¬í”Œë¡œìš° ë°˜ì˜
- **3ë‹¨ê³„ ê´€ë¦¬**: ê¸°ë³¸ì •ë³´ â†’ ìƒì‚°ì¤€ë¹„ â†’ ì–‘ì‚°ì¤€ë¹„
- **ì‹¤ì‹œê°„ í˜‘ì—…**: ë‹¤ì¤‘ ì‚¬ìš©ì ë™ì‹œ í¸ì§‘ ì§€ì›
- **ì§„í–‰ë¥  ì¶”ì **: ë‹¨ê³„ë³„ ìë™ ì§„í–‰ë¥  ê³„ì‚°
- **ì˜ê²¬ ì‹œìŠ¤í…œ**: í”„ë¡œì íŠ¸ë³„ í† ë¡  ë° í”¼ë“œë°±
- **ì˜¤í”„ë¼ì¸ ì§€ì›**: ë„¤íŠ¸ì›Œí¬ ë‹¨ì ˆ ì‹œì—ë„ ì œí•œì  ê¸°ëŠ¥ ì œê³µ
- **ê³ ì„±ëŠ¥**: ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬ ìµœì í™”

### v1.3ì˜ í˜ì‹ ì  ê°œì„ ì‚¬í•­
- **ì™„ì „í•œ Supabase í†µí•©**: localStorage ì˜ì¡´ì„± 100% ì œê±°
- **ì‹¤ì‹œê°„ ì—°ê²° ì•ˆì •ì„±**: ìë™ ì¬ì—°ê²° ë° ì˜¤í”„ë¼ì¸ ê°ì§€
- **ì„±ëŠ¥ ìµœì í™”**: ê°€ìƒí™”ëœ ë¦¬ìŠ¤íŠ¸, ì´ë¯¸ì§€ ìµœì í™”, ìºì‹±
- **ê°•í™”ëœ ë³´ì•ˆ**: Rate limiting, ë°ì´í„° ë¬´ê²°ì„± ê²€ì¦
- **í¬ê´„ì  ëª¨ë‹ˆí„°ë§**: ìƒì„¸í•œ í™œë™ ë¡œê·¸ ë° ì„±ëŠ¥ ì¶”ì 

### ì£¼ìš” ì‚¬ìš©ì
- **ì œí’ˆ ê°œë°œíŒ€**: í”„ë¡œì íŠ¸ ìƒì„± ë° ê´€ë¦¬
- **ìƒì‚°íŒ€**: ìƒì‚° ì¤€ë¹„ ê³¼ì • ê´€ë¦¬
- **í’ˆì§ˆíŒ€**: í’ˆì§ˆ ê²€ì¦ ë° í”¼ë“œë°±
- **ê´€ë¦¬ì**: ì „ì²´ ì‹œìŠ¤í…œ ê´€ë¦¬ ë° ëª¨ë‹ˆí„°ë§

---

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì¡°
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Frontend (React 18)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Pages          Components         Hooks          Utils     â”‚
â”‚  â”œâ”€ Auth        â”œâ”€ UI              â”œâ”€ Auth        â”œâ”€ API    â”‚
â”‚  â”œâ”€ Projects    â”œâ”€ Forms           â”œâ”€ Data        â”œâ”€ Utils  â”‚
â”‚  â”œâ”€ Admin       â”œâ”€ Layout          â”œâ”€ Realtime    â”œâ”€ Cache  â”‚
â”‚  â””â”€ Dashboard   â””â”€ Charts          â””â”€ Validation  â””â”€ Types  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   State Management                         â”‚
â”‚  â”œâ”€ React Query (ì„œë²„ ìƒíƒœ + ìºì‹±)                        â”‚
â”‚  â”œâ”€ Zustand (í´ë¼ì´ì–¸íŠ¸ ìƒíƒœ)                             â”‚
â”‚  â”œâ”€ IndexedDB (ì˜¤í”„ë¼ì¸ ì €ì¥ì†Œ)                           â”‚
â”‚  â””â”€ React Context (í…Œë§ˆ, ì„¤ì •)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    API Layer                               â”‚
â”‚  â”œâ”€ Supabase Client (ì‹¤ì‹œê°„ + ìºì‹±)                       â”‚
â”‚  â”œâ”€ Connection Monitor (ì—°ê²° ìƒíƒœ ê°ì§€)                   â”‚
â”‚  â”œâ”€ Rate Limiter (ìš”ì²­ ì œí•œ)                              â”‚
â”‚  â”œâ”€ Offline Sync (ì˜¤í”„ë¼ì¸ ë™ê¸°í™”)                        â”‚
â”‚  â””â”€ Error Recovery (ì—ëŸ¬ ë³µêµ¬)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                Backend (Supabase)                          â”‚
â”‚  â”œâ”€ PostgreSQL Database (ê³ ì„±ëŠ¥ ì¿¼ë¦¬)                     â”‚
â”‚  â”œâ”€ Row Level Security (RLS)                              â”‚
â”‚  â”œâ”€ Realtime Subscriptions (WebSocket)                   â”‚
â”‚  â”œâ”€ Auth (JWT + MFA ì§€ì›)                                 â”‚
â”‚  â”œâ”€ Storage (ìµœì í™”ëœ íŒŒì¼ ê´€ë¦¬)                          â”‚
â”‚  â”œâ”€ Edge Functions (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)                        â”‚
â”‚  â””â”€ Triggers & Functions (ë°ì´í„° ë¬´ê²°ì„±)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë°ì´í„° í”Œë¡œìš° ë° ìºì‹± ì „ëµ
```
User Action â†’ Component â†’ Custom Hook â†’ Cache Check â†’ Supabase API â†’ PostgreSQL
     â†‘                                      â†“              â†“
UI Update â† State Update â† React Query Cache â† Response â† Database Result
     â†‘                                      â†“
Optimistic Update â† IndexedDB (ì˜¤í”„ë¼ì¸) â† Background Sync
```

### ì—°ê²° ìƒíƒœ ê´€ë¦¬
```
Online + Connected    â†’ Full Functionality
Online + Disconnected â†’ Retry Logic + Error UI
Offline              â†’ IndexedDB + Limited Features
Recovery             â†’ Sync Pending Changes
```

---

## ğŸ—ƒï¸ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

### ERD (Enhanced Entity Relationship Diagram)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     users       â”‚    â”‚    profiles     â”‚    â”‚   projects      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (uuid) PK    â”‚â†â”€â”€â†’â”‚ id (uuid) PK    â”‚    â”‚ id (uuid) PK    â”‚
â”‚ email           â”‚    â”‚ user_id (uuid)FKâ”‚    â”‚ name            â”‚
â”‚ created_at      â”‚    â”‚ name            â”‚    â”‚ model_name      â”‚
â”‚ updated_at      â”‚    â”‚ team            â”‚    â”‚ description     â”‚
â”‚ email_confirmed â”‚    â”‚ role            â”‚    â”‚ status          â”‚
â”‚ phone           â”‚    â”‚ department      â”‚    â”‚ created_by (FK) â”‚
â”‚ last_sign_in    â”‚    â”‚ avatar_url      â”‚    â”‚ created_at      â”‚
â”‚ mfa_enabled     â”‚    â”‚ is_active       â”‚    â”‚ updated_at      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ preferences     â”‚    â”‚ cached_progress â”‚
                       â”‚ created_at      â”‚    â”‚ last_accessed   â”‚
                       â”‚ updated_at      â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
                                                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ project_stages  â”‚    â”‚    opinions     â”‚    â”‚ activity_logs   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (uuid) PK    â”‚    â”‚ id (uuid) PK    â”‚    â”‚ id (uuid) PK    â”‚
â”‚ project_id (FK) â”‚â†â”€â”€â†’â”‚ project_id (FK) â”‚    â”‚ user_id (FK)    â”‚
â”‚ stage_number    â”‚    â”‚ stage_id (FK)   â”‚    â”‚ project_id (FK) â”‚
â”‚ stage_data      â”‚    â”‚ author_id (FK)  â”‚    â”‚ action          â”‚
â”‚ progress        â”‚    â”‚ parent_id (FK)  â”‚    â”‚ details         â”‚
â”‚ version         â”‚    â”‚ title           â”‚    â”‚ timestamp       â”‚
â”‚ created_at      â”‚    â”‚ content         â”‚    â”‚ ip_address      â”‚
â”‚ updated_at      â”‚    â”‚ category        â”‚    â”‚ user_agent      â”‚
â”‚ updated_by      â”‚    â”‚ priority        â”‚    â”‚ session_id      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ tags            â”‚    â”‚ performance     â”‚
                       â”‚ status          â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ upvotes         â”‚
                       â”‚ downvotes       â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚ views           â”‚    â”‚ system_metrics  â”‚
                       â”‚ created_at      â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                       â”‚ updated_at      â”‚    â”‚ id (uuid) PK    â”‚
                       â”‚ resolved_at     â”‚    â”‚ metric_type     â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ value           â”‚
                                             â”‚ timestamp       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ metadata        â”‚
â”‚ opinion_reactionsâ”‚    â”‚project_collaboraâ”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (uuid) PK    â”‚    â”‚ id (uuid) PK    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ opinion_id (FK) â”‚    â”‚ project_id (FK) â”‚    â”‚ error_logs      â”‚
â”‚ user_id (FK)    â”‚    â”‚ user_id (FK)    â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ reaction_type   â”‚    â”‚ role            â”‚    â”‚ id (uuid) PK    â”‚
â”‚ created_at      â”‚    â”‚ permissions     â”‚    â”‚ user_id (FK)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ added_by (FK)   â”‚    â”‚ error_type      â”‚
                       â”‚ added_at        â”‚    â”‚ error_message   â”‚
                       â”‚ last_accessed   â”‚    â”‚ stack_trace     â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ context         â”‚
                                             â”‚ timestamp       â”‚
                                             â”‚ resolved        â”‚
                                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### í•µì‹¬ í…Œì´ë¸” ì •ì˜

#### 1. profiles (ì‚¬ìš©ì í”„ë¡œí•„) - í™•ì¥
```sql
CREATE TABLE profiles (
  id UUID REFERENCES auth.users(id) PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  team VARCHAR(100),
  role VARCHAR(20) DEFAULT 'user' CHECK (role IN ('user', 'admin', 'manager')),
  department VARCHAR(100),
  phone VARCHAR(20),
  avatar_url TEXT,
  is_active BOOLEAN DEFAULT true,
  preferences JSONB DEFAULT '{}',
  last_login_at TIMESTAMP WITH TIME ZONE,
  login_count INTEGER DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- ì‚¬ìš©ì í™˜ê²½ ì„¤ì • ì˜ˆì‹œ
-- preferences: {
--   "theme": "light",
--   "language": "ko",
--   "notifications": {
--     "email": true,
--     "browser": true,
--     "mentions": true
--   },
--   "dashboard": {
--     "layout": "grid",
--     "itemsPerPage": 20
--   }
-- }
```

#### 2. projects (í”„ë¡œì íŠ¸) - ì„±ëŠ¥ ìµœì í™”
```sql
CREATE TABLE projects (
  id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
  name VARCHAR(200) NOT NULL,
  model_name VARCHAR(100) UNIQUE NOT NULL,
  description TEXT,
  status VARCHAR(20) DEFAULT 'active' CHECK (status IN ('active', 'completed', 'on_hold', 'cancelled')),
  created_by UUID REFERENCES auth.users(id) NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  completed_at TIMESTAMP WITH TIME ZONE,
  last_accessed_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  
  -- ì„±ëŠ¥ ìµœì í™” í•„ë“œ
  cached_progress INTEGER DEFAULT 0 CHECK (cached_progress >= 0 AND cached_progress <= 100),
  search_vector TSVECTOR, -- ì „ë¬¸ ê²€ìƒ‰ ì§€ì›
  
  -- ë©”íƒ€ë°ì´í„°
  tags TEXT[],
  priority VARCHAR(20) DEFAULT 'medium' CHECK (priority IN ('low', 'medium', 'high', 'urgent')),
  estimated_completion_date DATE,
  actual_completion_date DATE,
  
  -- í˜‘ì—… ì •ë³´
  collaborator_count INTEGER DEFAULT 0,
  opinion_count INTEGER DEFAULT 0,
  last_activity_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- ê²€ìƒ‰ ì„±ëŠ¥ì„ ìœ„í•œ ì¸ë±ìŠ¤
CREATE INDEX idx_projects_search ON projects USING GIN(search_vector);
CREATE INDEX idx_projects_status ON projects(status);
CREATE INDEX idx_projects_created_by ON projects(created_by);
CREATE INDEX idx_projects_last_activity ON projects(last_activity_at DESC);
```

#### 3. project_stages (í”„ë¡œì íŠ¸ ë‹¨ê³„) - ë²„ì „ ê´€ë¦¬
```sql
CREATE TABLE project_stages (
  id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
  project_id UUID REFERENCES projects(id) ON DELETE CASCADE NOT NULL,
  stage_number INTEGER NOT NULL CHECK (stage_number IN (1, 2, 3)),
  stage_data JSONB NOT NULL DEFAULT '{}',
  progress INTEGER DEFAULT 0 CHECK (progress >= 0 AND progress <= 100),
  version INTEGER DEFAULT 1, -- ë²„ì „ ê´€ë¦¬
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_by UUID REFERENCES auth.users(id),
  
  -- ë³€ê²½ ì¶”ì 
  previous_data JSONB, -- ì´ì „ ë²„ì „ ë°ì´í„°
  change_summary TEXT, -- ë³€ê²½ ìš”ì•½
  
  UNIQUE(project_id, stage_number)
);

-- ì„±ëŠ¥ ì¸ë±ìŠ¤
CREATE INDEX idx_project_stages_project ON project_stages(project_id, stage_number);
CREATE INDEX idx_project_stages_updated ON project_stages(updated_at DESC);
```

#### 4. opinions (ì˜ê²¬/ëŒ“ê¸€) - ê³ ì„±ëŠ¥ ìŠ¤ë ˆë”©
```sql
CREATE TABLE opinions (
  id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
  project_id UUID REFERENCES projects(id) ON DELETE CASCADE NOT NULL,
  stage_id UUID REFERENCES project_stages(id) ON DELETE CASCADE,
  parent_id UUID REFERENCES opinions(id) ON DELETE CASCADE, -- ë‹µê¸€ ì§€ì›
  thread_path LTREE, -- ê³„ì¸µ êµ¬ì¡° ê³ ì„±ëŠ¥ ì²˜ë¦¬
  author_id UUID REFERENCES auth.users(id) NOT NULL,
  title VARCHAR(200),
  content TEXT NOT NULL,
  category VARCHAR(50) DEFAULT 'general',
  priority VARCHAR(20) DEFAULT 'medium' CHECK (priority IN ('low', 'medium', 'high', 'urgent')),
  tags TEXT[],
  status VARCHAR(20) DEFAULT 'open' CHECK (status IN ('open', 'in_review', 'resolved', 'closed')),
  is_private BOOLEAN DEFAULT false,
  notify_on_reply BOOLEAN DEFAULT true,
  
  -- ìƒí˜¸ì‘ìš© ë©”íŠ¸ë¦­
  upvotes INTEGER DEFAULT 0,
  downvotes INTEGER DEFAULT 0,
  views INTEGER DEFAULT 0,
  reply_count INTEGER DEFAULT 0,
  
  -- ì‹œê°„ ì¶”ì 
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  resolved_at TIMESTAMP WITH TIME ZONE,
  last_activity_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  
  -- ê²€ìƒ‰ ì§€ì›
  search_vector TSVECTOR
);

-- ê³ ì„±ëŠ¥ ì¸ë±ìŠ¤
CREATE INDEX idx_opinions_project ON opinions(project_id, created_at DESC);
CREATE INDEX idx_opinions_author ON opinions(author_id);
CREATE INDEX idx_opinions_thread ON opinions USING GIST(thread_path);
CREATE INDEX idx_opinions_search ON opinions USING GIN(search_vector);
CREATE INDEX idx_opinions_status ON opinions(status, priority);
```

#### 5. activity_logs (í™œë™ ë¡œê·¸) - ìƒì„¸ ì¶”ì 
```sql
CREATE TABLE activity_logs (
  id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id),
  project_id UUID REFERENCES projects(id) ON DELETE CASCADE,
  opinion_id UUID REFERENCES opinions(id) ON DELETE CASCADE,
  action VARCHAR(100) NOT NULL,
  details JSONB,
  timestamp TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  ip_address INET,
  user_agent TEXT,
  session_id UUID,
  
  -- ì„±ëŠ¥ ë©”íŠ¸ë¦­
  response_time_ms INTEGER,
  memory_usage_mb FLOAT,
  
  -- ì§€ë¦¬ì  ì •ë³´
  country_code CHAR(2),
  city VARCHAR(100)
);

-- íŒŒí‹°ì…”ë‹ì„ ìœ„í•œ ì¸ë±ìŠ¤ (ì›”ë³„)
CREATE INDEX idx_activity_logs_timestamp ON activity_logs(timestamp);
CREATE INDEX idx_activity_logs_user_action ON activity_logs(user_id, action);
CREATE INDEX idx_activity_logs_project ON activity_logs(project_id, timestamp DESC);
```

#### 6. system_metrics (ì‹œìŠ¤í…œ ë©”íŠ¸ë¦­)
```sql
CREATE TABLE system_metrics (
  id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
  metric_type VARCHAR(50) NOT NULL,
  value NUMERIC NOT NULL,
  timestamp TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  metadata JSONB DEFAULT '{}',
  
  -- ì§‘ê³„ ë ˆë²¨
  aggregation_level VARCHAR(20) DEFAULT 'raw' CHECK (aggregation_level IN ('raw', 'hourly', 'daily', 'weekly'))
);

-- ë©”íŠ¸ë¦­ ì¢…ë¥˜:
-- 'active_users', 'concurrent_sessions', 'api_response_time', 
-- 'database_connections', 'memory_usage', 'cpu_usage',
-- 'project_creation_rate', 'opinion_creation_rate'
```

#### 7. error_logs (ì—ëŸ¬ ë¡œê·¸)
```sql
CREATE TABLE error_logs (
  id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id),
  error_type VARCHAR(100) NOT NULL,
  error_message TEXT NOT NULL,
  stack_trace TEXT,
  context JSONB DEFAULT '{}',
  timestamp TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  resolved BOOLEAN DEFAULT false,
  resolved_at TIMESTAMP WITH TIME ZONE,
  resolved_by UUID REFERENCES auth.users(id)
);
```

### Stage Data Structure (JSONB) - í™•ì¥

#### Stage 1 (ê¸°ë³¸ì •ë³´) - í•„ë“œ ì •ì˜
```typescript
interface Stage1Data {
  // ê¸°ë³¸ ì •ë³´
  productGroup: string;           // ì œí’ˆêµ°
  manufacturer: string;           // ì œì¡°ì‚¬
  vendor: string;                // ê³µê¸‰ì—…ì²´
  derivativeModel: string;       // íŒŒìƒ ëª¨ë¸
  
  // ì¼ì • ê´€ë¦¬
  launchDate: string;            // ì¶œì‹œ ì˜ˆì •ì¼
  launchDateExecuted: boolean;   // ì¶œì‹œ ì™„ë£Œ ì—¬ë¶€
  massProductionDate: string;    // ì–‘ì‚° ì˜ˆì •ì¼
  massProductionDateExecuted: boolean; // ì–‘ì‚° ì™„ë£Œ ì—¬ë¶€
  
  // ë‹´ë‹¹ì ì •ë³´
  productManager: string;        // ì œí’ˆ ë‹´ë‹¹ì
  mechanicalEngineer: string;    // ê¸°êµ¬ ë‹´ë‹¹ì
  circuitEngineer: string;       // íšŒë¡œ ë‹´ë‹¹ì
  
  // ì¶”ê°€ ë©”íƒ€ë°ì´í„°
  notes: string;                 // ë¹„ê³ 
  attachments: FileAttachment[]; // ì²¨ë¶€ íŒŒì¼
  estimatedBudget: number;       // ì˜ˆìƒ ì˜ˆì‚°
  targetMarket: string[];        // ëª©í‘œ ì‹œì¥
  
  // ìŠ¹ì¸ í”„ë¡œì„¸ìŠ¤
  approvals: {
    productPlanning: ApprovalStatus;
    engineering: ApprovalStatus;
    marketing: ApprovalStatus;
  };
}

interface ApprovalStatus {
  approved: boolean;
  approver: string;
  approvedAt: string;
  comments: string;
}
```

#### Stage 2 (ìƒì‚°ì¤€ë¹„) - ìƒì„¸ í™•ì¥
```typescript
interface Stage2Data {
  // íŒŒì¼ëŸ¿ ìƒì‚°
  pilotProductionDate: string;
  pilotProductionDateExecuted: boolean;
  pilotQuantity: number;
  pilotLocation: string;
  pilotResults: {
    quality: 'pass' | 'fail' | 'pending';
    yield: number;
    issues: string[];
    recommendations: string[];
  };
  
  // ê¸°ìˆ  ì´ì „
  techTransferDate: string;
  techTransferDateExecuted: boolean;
  techTransferDocuments: FileAttachment[];
  installationParty: string;
  serviceParty: string;
  
  // êµìœ¡ ë° ë§¤ë‰´ì–¼
  trainingDate: string;
  trainingDateExecuted: boolean;
  trainingAttendees: string[];
  userManualUpload: string;
  techManualUpload: string;
  userManualUploaded: boolean;
  techManualUploaded: boolean;
  
  // ìƒì‚° ì¤€ë¹„ë„ ê²€ì¦
  equipmentReadiness: number;    // ì„¤ë¹„ ì¤€ë¹„ë„ (0-100%)
  materialReadiness: number;     // ìì¬ ì¤€ë¹„ë„ (0-100%)
  personnelReadiness: number;    // ì¸ë ¥ ì¤€ë¹„ë„ (0-100%)
  
  notes: string;
}
```

#### Stage 3 (ì–‘ì‚°ì¤€ë¹„) - í†µí•© ê´€ë¦¬
```typescript
interface Stage3Data {
  // BOM ê´€ë¦¬
  bomManager: string;
  bomCompletionDate: string;
  bomCompletionDateExecuted: boolean;
  bomVersion: string;
  bomStatus: 'draft' | 'review' | 'approved' | 'locked';
  
  // ë‹¨ê°€ ê´€ë¦¬
  priceManager: string;
  priceRegistrationDate: string;
  priceRegistrationDateExecuted: boolean;
  targetPrice: number;
  actualPrice: number;
  priceVariance: number;
  
  // ë¶€í’ˆ ìˆ˜ê¸‰
  firstPartsOrderDate: string;
  firstPartsOrderDateExecuted: boolean;
  partsReceiptDate: string;
  partsReceiptDateExecuted: boolean;
  partsReceiptManager: string;
  supplierReadiness: {
    [supplierId: string]: {
      name: string;
      status: 'ready' | 'pending' | 'delayed';
      deliveryDate: string;
    };
  };
  
  // ì§€ì  ì£¼ë¬¸ ê°€ì´ë“œ
  branchOrderGuideDate: string;
  branchOrderGuideDateExecuted: boolean;
  orderGuideDocuments: FileAttachment[];
  distributionChannels: string[];
  
  // í’ˆì§ˆ ê´€ë¦¬
  qualityChecklist: {
    [checkItem: string]: {
      completed: boolean;
      completedBy: string;
      completedAt: string;
      notes: string;
    };
  };
  
  notes: string;
}

interface FileAttachment {
  id: string;
  name: string;
  url: string;
  size: number;
  mimeType: string;
  uploadedBy: string;
  uploadedAt: string;
}
```

### ë°ì´í„°ë² ì´ìŠ¤ í•¨ìˆ˜ ë° íŠ¸ë¦¬ê±°

#### ìë™ ì§„í–‰ë¥  ê³„ì‚° íŠ¸ë¦¬ê±°
```sql
-- ë‹¨ê³„ ë°ì´í„° ì—…ë°ì´íŠ¸ ì‹œ ìë™ ì§„í–‰ë¥  ê³„ì‚°
CREATE OR REPLACE FUNCTION update_stage_progress()
RETURNS TRIGGER AS $$
BEGIN
  NEW.progress := calculate_stage_progress(NEW.stage_data, NEW.stage_number);
  NEW.updated_at := NOW();
  
  -- í”„ë¡œì íŠ¸ ì „ì²´ ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
  UPDATE projects 
  SET cached_progress = calculate_project_overall_progress(NEW.project_id),
      updated_at = NOW(),
      last_activity_at = NOW()
  WHERE id = NEW.project_id;
  
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_update_stage_progress
  BEFORE UPDATE ON project_stages
  FOR EACH ROW
  EXECUTE FUNCTION update_stage_progress();
```

#### ê²€ìƒ‰ ë²¡í„° ì—…ë°ì´íŠ¸
```sql
-- í”„ë¡œì íŠ¸ ê²€ìƒ‰ ë²¡í„° ìë™ ì—…ë°ì´íŠ¸
CREATE OR REPLACE FUNCTION update_project_search_vector()
RETURNS TRIGGER AS $$
BEGIN
  NEW.search_vector := 
    setweight(to_tsvector('korean', COALESCE(NEW.name, '')), 'A') ||
    setweight(to_tsvector('korean', COALESCE(NEW.model_name, '')), 'A') ||
    setweight(to_tsvector('korean', COALESCE(NEW.description, '')), 'B') ||
    setweight(to_tsvector('korean', array_to_string(NEW.tags, ' ')), 'C');
  
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_update_project_search
  BEFORE INSERT OR UPDATE ON projects
  FOR EACH ROW
  EXECUTE FUNCTION update_project_search_vector();
```

#### ì˜ê²¬ ìŠ¤ë ˆë“œ ê²½ë¡œ ê´€ë¦¬
```sql
-- ì˜ê²¬ ë‹µê¸€ ê³„ì¸µ êµ¬ì¡° ìë™ ê´€ë¦¬
CREATE OR REPLACE FUNCTION manage_opinion_thread_path()
RETURNS TRIGGER AS $$
BEGIN
  IF NEW.parent_id IS NULL THEN
    -- ìµœìƒìœ„ ì˜ê²¬
    NEW.thread_path := NEW.id::text::ltree;
  ELSE
    -- ë‹µê¸€ì¸ ê²½ìš° ë¶€ëª¨ ê²½ë¡œì— ì¶”ê°€
    SELECT thread_path || NEW.id::text::ltree
    INTO NEW.thread_path
    FROM opinions
    WHERE id = NEW.parent_id;
    
    -- ë¶€ëª¨ ì˜ê²¬ì˜ ë‹µê¸€ ìˆ˜ ì¦ê°€
    UPDATE opinions 
    SET reply_count = reply_count + 1
    WHERE id = NEW.parent_id;
  END IF;
  
  -- í”„ë¡œì íŠ¸ ì˜ê²¬ ìˆ˜ ì—…ë°ì´íŠ¸
  UPDATE projects 
  SET opinion_count = opinion_count + 1,
      last_activity_at = NOW()
  WHERE id = NEW.project_id;
  
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_manage_opinion_thread
  BEFORE INSERT ON opinions
  FOR EACH ROW
  EXECUTE FUNCTION manage_opinion_thread_path();
```

---

## ğŸ” Row Level Security (RLS) ì •ì±… - ê³ ë„í™”

### ë‹¤ì¸µ ë³´ì•ˆ ëª¨ë¸
```sql
-- ë™ì  ê¶Œí•œ ì²´í¬ í•¨ìˆ˜
CREATE OR REPLACE FUNCTION check_user_project_access(project_uuid UUID, required_permission TEXT)
RETURNS BOOLEAN AS $$
DECLARE
  user_uuid UUID := auth.uid();
  user_role TEXT;
  is_owner BOOLEAN := FALSE;
  is_collaborator BOOLEAN := FALSE;
  collaborator_role TEXT;
BEGIN
  -- ì‚¬ìš©ì ì—­í•  í™•ì¸
  SELECT role INTO user_role FROM profiles WHERE id = user_uuid;
  
  -- ê´€ë¦¬ìëŠ” ëª¨ë“  ê¶Œí•œ
  IF user_role IN ('admin', 'manager') THEN
    RETURN TRUE;
  END IF;
  
  -- í”„ë¡œì íŠ¸ ì†Œìœ ì í™•ì¸
  SELECT created_by = user_uuid INTO is_owner FROM projects WHERE id = project_uuid;
  
  -- í˜‘ì—…ì ê¶Œí•œ í™•ì¸
  SELECT 
    CASE WHEN COUNT(*) > 0 THEN TRUE ELSE FALSE END,
    MAX(role)
  INTO is_collaborator, collaborator_role
  FROM project_collaborators 
  WHERE project_id = project_uuid AND user_id = user_uuid;
  
  -- ê¶Œí•œë³„ ì ‘ê·¼ ì œì–´
  CASE required_permission
    WHEN 'view' THEN
      RETURN is_owner OR is_collaborator OR user_role = 'manager';
    WHEN 'edit' THEN
      RETURN is_owner OR collaborator_role IN ('owner', 'editor') OR user_role = 'admin';
    WHEN 'delete' THEN
      RETURN is_owner OR user_role = 'admin';
    WHEN 'manage_collaborators' THEN
      RETURN is_owner OR user_role = 'admin';
    ELSE
      RETURN FALSE;
  END CASE;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;
```

### ì„¸ë°€í•œ RLS ì •ì±…
```sql
-- í”„ë¡œì íŠ¸ ì¡°íšŒ ì •ì±…
CREATE POLICY "Dynamic project access"
ON projects FOR SELECT
USING (check_user_project_access(id, 'view'));

-- í”„ë¡œì íŠ¸ ìˆ˜ì • ì •ì±…
CREATE POLICY "Dynamic project update"
ON projects FOR UPDATE
USING (check_user_project_access(id, 'edit'))
WITH CHECK (check_user_project_access(id, 'edit'));

-- ì˜ê²¬ ì¡°íšŒ ì •ì±… (ë¹„ê³µê°œ ì˜ê²¬ ì²˜ë¦¬)
CREATE POLICY "Opinion access with privacy"
ON opinions FOR SELECT
USING (
  NOT is_private OR 
  author_id = auth.uid() OR 
  check_user_project_access(project_id, 'edit') OR
  EXISTS (
    SELECT 1 FROM profiles 
    WHERE id = auth.uid() AND role IN ('admin', 'manager')
  )
);

-- í™œë™ ë¡œê·¸ ì •ì±… (ê´€ë¦¬ìë§Œ)
CREATE POLICY "Admin only activity logs"
ON activity_logs FOR SELECT
USING (
  EXISTS (
    SELECT 1 FROM profiles 
    WHERE id = auth.uid() AND role = 'admin'
  ) OR
  user_id = auth.uid() -- ìì‹ ì˜ í™œë™ë§Œ ì¡°íšŒ ê°€ëŠ¥
);
```

---

## ğŸ§­ í˜ì´ì§€ êµ¬ì¡° ë° ë¼ìš°íŒ…

### ë¼ìš°íŒ… ì‹œìŠ¤í…œ (React Router v6)
```typescript
// ë¼ìš°íŒ… êµ¬ì¡°
const routes = {
  // ì¸ì¦
  '/auth/login': 'ë¡œê·¸ì¸',
  '/auth/register': 'íšŒì›ê°€ì…',
  '/auth/forgot-password': 'ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •',
  '/auth/verify-email': 'ì´ë©”ì¼ ì¸ì¦',
  '/auth/mfa-setup': '2ë‹¨ê³„ ì¸ì¦ ì„¤ì •',
  
  // ë©”ì¸ ì˜ì—­
  '/': 'í™ˆ (ëŒ€ì‹œë³´ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸)',
  '/dashboard': 'ë©”ì¸ ëŒ€ì‹œë³´ë“œ',
  
  // í”„ë¡œì íŠ¸ ê´€ë¦¬
  '/projects': 'í”„ë¡œì íŠ¸ ëª©ë¡',
  '/projects/new': 'ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±',
  '/projects/:id': 'í”„ë¡œì íŠ¸ ìƒì„¸ë³´ê¸°',
  '/projects/:id/edit': 'í”„ë¡œì íŠ¸ í¸ì§‘',
  '/projects/:id/stages/:stage': 'íŠ¹ì • ë‹¨ê³„ í¸ì§‘',
  '/projects/:id/collaborators': 'í˜‘ì—…ì ê´€ë¦¬',
  '/projects/:id/history': 'ë³€ê²½ ì´ë ¥',
  '/projects/completed': 'ì™„ë£Œëœ í”„ë¡œì íŠ¸',
  '/projects/templates': 'í”„ë¡œì íŠ¸ í…œí”Œë¦¿',
  
  // ì˜ê²¬ ê´€ë¦¬
  '/opinions': 'ì „ì²´ ì˜ê²¬ ëª©ë¡',
  '/opinions/:id': 'ì˜ê²¬ ìƒì„¸ë³´ê¸°',
  
  // ë¦¬í¬íŠ¸ ë° ë¶„ì„
  '/reports': 'ë¦¬í¬íŠ¸ ëŒ€ì‹œë³´ë“œ',
  '/reports/progress': 'ì§„í–‰ë¥  ë¶„ì„',
  '/reports/performance': 'ì„±ëŠ¥ ë¶„ì„',
  '/reports/export': 'ë°ì´í„° ë‚´ë³´ë‚´ê¸°',
  
  // ë‹¬ë ¥ ë° ì¼ì •
  '/calendar': 'ìº˜ë¦°ë” ë·°',
  '/calendar/gantt': 'ê°„íŠ¸ ì°¨íŠ¸',
  
  // ê´€ë¦¬ì
  '/admin': 'ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ',
  '/admin/users': 'ì‚¬ìš©ì ê´€ë¦¬',
  '/admin/audit': 'ê°ì‚¬ ë¡œê·¸',
  '/admin/security': 'ë³´ì•ˆ ì„¤ì •',
  '/admin/system': 'ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§',
  '/admin/backup': 'ë°±ì—… ê´€ë¦¬',
  
  // ì‚¬ìš©ì ì„¤ì •
  '/profile': 'í”„ë¡œí•„ ê´€ë¦¬',
  '/settings': 'ì„¤ì •',
  '/settings/notifications': 'ì•Œë¦¼ ì„¤ì •',
  '/settings/privacy': 'ê°œì¸ì •ë³´ ì„¤ì •',
  
  // ë„ì›€ë§
  '/help': 'ë„ì›€ë§',
  '/help/getting-started': 'ì‹œì‘í•˜ê¸°',
  '/help/tutorials': 'íŠœí† ë¦¬ì–¼',
  '/help/faq': 'ìì£¼ ë¬»ëŠ” ì§ˆë¬¸'
};
```

### ê³ ê¸‰ ë¼ìš°í„° êµ¬ì„±
```typescript
// src/router/AppRouter.tsx
import { createBrowserRouter, RouterProvider } from 'react-router-dom';
import { Suspense, lazy } from 'react';
import { ErrorBoundary } from '../components/ErrorBoundary';
import { LoadingSpinner } from '../components/ui/LoadingSpinner';
import { ProtectedRoute } from '../components/auth/ProtectedRoute';
import { AdminRoute } from '../components/auth/AdminRoute';

// ì§€ì—° ë¡œë”©ì„ ìœ„í•œ ì»´í¬ë„ŒíŠ¸ ë¶„í• 
const Dashboard = lazy(() => import('../pages/Dashboard'));
const ProjectList = lazy(() => import('../pages/projects/ProjectList'));
const ProjectDetail = lazy(() => import('../pages/projects/ProjectDetail'));
const ProjectEdit = lazy(() => import('../pages/projects/ProjectEdit'));
const AdminPanel = lazy(() => import('../pages/admin/AdminPanel'));

const router = createBrowserRouter([
  {
    path: '/',
    element: <RootLayout />,
    errorElement: <GlobalErrorPage />,
    children: [
      // ê³µê°œ ë¼ìš°íŠ¸
      {
        path: 'auth',
        children: [
          { path: 'login', element: <LoginPage /> },
          { path: 'register', element: <RegisterPage /> },
          { path: 'forgot-password', element: <ForgotPasswordPage /> },
        ]
      },
      
      // ë³´í˜¸ëœ ë¼ìš°íŠ¸
      {
        path: '/',
        element: <ProtectedRoute />,
        children: [
          { index: true, element: <Navigate to="/dashboard" replace /> },
          {
            path: 'dashboard',
            element: (
              <Suspense fallback={<LoadingSpinner />}>
                <Dashboard />
              </Suspense>
            )
          },
          {
            path: 'projects',
            children: [
              {
                index: true,
                element: (
                  <Suspense fallback={<LoadingSpinner />}>
                    <ProjectList />
                  </Suspense>
                )
              },
              {
                path: ':id',
                element: (
                  <Suspense fallback={<LoadingSpinner />}>
                    <ProjectDetail />
                  </Suspense>
                )
              },
              {
                path: ':id/edit',
                element: (
                  <Suspense fallback={<LoadingSpinner />}>
                    <ProjectEdit />
                  </Suspense>
                )
              }
            ]
          },
          
          // ê´€ë¦¬ì ì „ìš© ë¼ìš°íŠ¸
          {
            path: 'admin',
            element: <AdminRoute />,
            children: [
              {
                index: true,
                element: (
                  <Suspense fallback={<LoadingSpinner />}>
                    <AdminPanel />
                  </Suspense>
                )
              }
            ]
          }
        ]
      }
    ]
  }
]);

export const AppRouter = () => (
  <ErrorBoundary>
    <RouterProvider router={router} />
  </ErrorBoundary>
);
```

### í˜ì´ì§€ë³„ ìƒì„¸ ëª…ì„¸

#### 1. í–¥ìƒëœ ëŒ€ì‹œë³´ë“œ (/dashboard)
```typescript
interface DashboardProps {
  // ëŒ€ì‹œë³´ë“œ êµ¬ì„± ìš”ì†Œ
}

const Dashboard: React.FC<DashboardProps> = () => {
  const { data: stats } = useDashboardStats();
  const { data: recentProjects } = useRecentProjects(5);
  const { data: myTasks } = useMyTasks();
  const { data: notifications } = useNotifications();
  
  return (
    <div className="space-y-6">
      {/* ìƒë‹¨ ë©”íŠ¸ë¦­ ì¹´ë“œ */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <MetricCard
          title="ì „ì²´ í”„ë¡œì íŠ¸"
          value={stats?.totalProjects}
          change={stats?.projectsChange}
          trend="up"
          icon={FolderIcon}
        />
        <MetricCard
          title="ì§„í–‰ì¤‘ í”„ë¡œì íŠ¸"
          value={stats?.activeProjects}
          change={stats?.activeChange}
          trend="stable"
          icon={PlayIcon}
        />
        <MetricCard
          title="í‰ê·  ì§„í–‰ë¥ "
          value={`${stats?.avgProgress}%`}
          change={stats?.progressChange}
          trend="up"
          icon={TrendingUpIcon}
        />
        <MetricCard
          title="ì´ë²ˆ ì£¼ ì™„ë£Œ"
          value={stats?.weeklyCompleted}
          change={stats?.completedChange}
          trend="up"
          icon={CheckCircleIcon}
        />
      </div>
      
      {/* ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ */}
      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        {/* ì§„í–‰ë¥  ì°¨íŠ¸ */}
        <div className="lg:col-span-2">
          <Card>
            <CardHeader>
              <CardTitle>í”„ë¡œì íŠ¸ ì§„í–‰ë¥  ë¶„ì„</CardTitle>
            </CardHeader>
            <CardContent>
              <ProgressChart data={stats?.progressData} />
            </CardContent>
          </Card>
        </div>
        
        {/* ìµœê·¼ í™œë™ */}
        <div>
          <Card>
            <CardHeader>
              <CardTitle>ìµœê·¼ í™œë™</CardTitle>
            </CardHeader>
            <CardContent>
              <ActivityTimeline activities={stats?.recentActivities} />
            </CardContent>
          </Card>
        </div>
      </div>
      
      {/* í•˜ë‹¨ ì„¹ì…˜ */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* ë‚´ í”„ë¡œì íŠ¸ */}
        <Card>
          <CardHeader>
            <CardTitle>ìµœê·¼ í”„ë¡œì íŠ¸</CardTitle>
            <Link to="/projects" className="text-blue-600 hover:text-blue-800">
              ëª¨ë‘ ë³´ê¸°
            </Link>
          </CardHeader>
          <CardContent>
            <div className="space-y-3">
              {recentProjects?.map(project => (
                <ProjectMiniCard key={project.id} project={project} />
              ))}
            </div>
          </CardContent>
        </Card>
        
        {/* ë‚´ í• ì¼ */}
        <Card>
          <CardHeader>
            <CardTitle>ë‚´ í• ì¼</CardTitle>
          </CardHeader>
          <CardContent>
            <TaskList tasks={myTasks} />
          </CardContent>
        </Card>
      </div>
      
      {/* ì•Œë¦¼ ë° ê³µì§€ì‚¬í•­ */}
      <Card>
        <CardHeader>
          <CardTitle>ì•Œë¦¼ ë° ê³µì§€ì‚¬í•­</CardTitle>
        </CardHeader>
        <CardContent>
          <NotificationList notifications={notifications} />
        </CardContent>
      </Card>
    </div>
  );
};
```

#### 2. ê³ ì„±ëŠ¥ í”„ë¡œì íŠ¸ ëª©ë¡ (/projects)
```typescript
const ProjectList: React.FC = () => {
  const [viewMode, setViewMode] = useState<'grid' | 'list' | 'table'>('grid');
  const [filters, setFilters] = useState<ProjectFilters>({});
  const [sortBy, setSortBy] = useState<SortOption>('updated_at');
  const [searchQuery, setSearchQuery] = useState('');
  
  // ë¬´í•œ ìŠ¤í¬ë¡¤ì„ ìœ„í•œ React Query
  const {
    data,
    fetchNextPage,
    hasNextPage,
    isFetchingNextPage,
    isLoading
  } = useInfiniteProjects({
    filters,
    sortBy,
    search: searchQuery,
    pageSize: 20
  });
  
  // ê°€ìƒí™”ëœ ë¦¬ìŠ¤íŠ¸ (ëŒ€ëŸ‰ ë°ì´í„° ì²˜ë¦¬)
  const allProjects = useMemo(() => {
    return data?.pages.flatMap(page => page.projects) || [];
  }, [data]);
  
  return (
    <div className="space-y-6">
      {/* í—¤ë” */}
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold text-gray-900">í”„ë¡œì íŠ¸ ê´€ë¦¬</h1>
          <p className="text-gray-600">ì „ì²´ {data?.pages[0]?.total || 0}ê°œ í”„ë¡œì íŠ¸</p>
        </div>
        <div className="flex space-x-3">
          <Button onClick={() => setViewMode('grid')} variant={viewMode === 'grid' ? 'default' : 'outline'}>
            <GridIcon className="w-4 h-4" />
          </Button>
          <Button onClick={() => setViewMode('list')} variant={viewMode === 'list' ? 'default' : 'outline'}>
            <ListIcon className="w-4 h-4" />
          </Button>
          <Button onClick={() => setViewMode('table')} variant={viewMode === 'table' ? 'default' : 'outline'}>
            <TableIcon className="w-4 h-4" />
          </Button>
          <Link to="/projects/new">
            <Button>
              <PlusIcon className="w-4 h-4 mr-2" />
              ìƒˆ í”„ë¡œì íŠ¸
            </Button>
          </Link>
        </div>
      </div>
      
      {/* í•„í„°ë§ ë° ê²€ìƒ‰ */}
      <div className="flex flex-col lg:flex-row gap-4">
        <div className="flex-1">
          <SearchInput
            value={searchQuery}
            onChange={setSearchQuery}
            placeholder="í”„ë¡œì íŠ¸ëª…, ëª¨ë¸ëª…ìœ¼ë¡œ ê²€ìƒ‰..."
            debounceMs={300}
          />
        </div>
        <ProjectFilters
          filters={filters}
          onChange={setFilters}
          sortBy={sortBy}
          onSortChange={setSortBy}
        />
      </div>
      
      {/* í”„ë¡œì íŠ¸ ëª©ë¡ */}
      {isLoading ? (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {Array.from({ length: 6 }).map((_, i) => (
            <ProjectCardSkeleton key={i} />
          ))}
        </div>
      ) : viewMode === 'grid' ? (
        <VirtualizedProjectGrid
          projects={allProjects}
          onLoadMore={fetchNextPage}
          hasMore={hasNextPage}
          isLoadingMore={isFetchingNextPage}
        />
      ) : viewMode === 'list' ? (
        <VirtualizedProjectList
          projects={allProjects}
          onLoadMore={fetchNextPage}
          hasMore={hasNextPage}
          isLoadingMore={isFetchingNextPage}
        />
      ) : (
        <ProjectTable
          projects={allProjects}
          onLoadMore={fetchNextPage}
          hasMore={hasNextPage}
          isLoadingMore={isFetchingNextPage}
        />
      )}
      
      {/* ë¹ˆ ìƒíƒœ */}
      {!isLoading && allProjects.length === 0 && (
        <EmptyState
          title="í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤"
          description="ì²« ë²ˆì§¸ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•´ë³´ì„¸ìš”."
          action={
            <Link to="/projects/new">
              <Button>ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±</Button>
            </Link>
          }
        />
      )}
    </div>
  );
};
```

---

## ğŸ¨ UI/UX ì»´í¬ë„ŒíŠ¸ ì‹œìŠ¤í…œ

### í™•ì¥ëœ ë””ìì¸ ì‹œìŠ¤í…œ

#### ë‹¤í¬ ëª¨ë“œ ì§€ì›
```css
:root {
  /* ë¼ì´íŠ¸ ëª¨ë“œ */
  --bg-primary: #ffffff;
  --bg-secondary: #f8fafc;
  --text-primary: #1f2937;
  --text-secondary: #6b7280;
  --border-primary: #e5e7eb;
  
  /* ì¿ ì¿  ë¸Œëœë“œ ì»¬ëŸ¬ */
  --cuckoo-red: #dc2626;
  --cuckoo-red-light: #fee2e2;
  --cuckoo-red-dark: #991b1b;
}

[data-theme="dark"] {
  /* ë‹¤í¬ ëª¨ë“œ */
  --bg-primary: #111827;
  --bg-secondary: #1f2937;
  --text-primary: #f9fafb;
  --text-secondary: #d1d5db;
  --border-primary: #374151;
  
  /* ë‹¤í¬ ëª¨ë“œìš© ì¿ ì¿  ì»¬ëŸ¬ */
  --cuckoo-red: #ef4444;
  --cuckoo-red-light: #fee2e2;
  --cuckoo-red-dark: #dc2626;
}

/* ì• ë‹ˆë©”ì´ì…˜ */
.theme-transition {
  transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
}
```

#### ë°˜ì‘í˜• íƒ€ì´í¬ê·¸ë˜í”¼
```css
/* ìœ ì—°í•œ íƒ€ì´í¬ê·¸ë˜í”¼ ì‹œìŠ¤í…œ */
.text-responsive-xs { font-size: clamp(0.75rem, 0.7rem + 0.25vw, 0.875rem); }
.text-responsive-sm { font-size: clamp(0.875rem, 0.8rem + 0.375vw, 1rem); }
.text-responsive-base { font-size: clamp(1rem, 0.9rem + 0.5vw, 1.125rem); }
.text-responsive-lg { font-size: clamp(1.125rem, 1rem + 0.625vw, 1.25rem); }
.text-responsive-xl { font-size: clamp(1.25rem, 1.1rem + 0.75vw, 1.5rem); }
.text-responsive-2xl { font-size: clamp(1.5rem, 1.3rem + 1vw, 2rem); }
.text-responsive-3xl { font-size: clamp(1.875rem, 1.6rem + 1.375vw, 2.5rem); }

/* í•œêµ­ì–´ ìµœì í™” */
.korean-text {
  font-family: 'Noto Sans KR', 'Apple SD Gothic Neo', sans-serif;
  word-break: keep-all;
  line-height: 1.7;
}
```

### ê³ ì„±ëŠ¥ ì»´í¬ë„ŒíŠ¸

#### 1. ê°€ìƒí™”ëœ í”„ë¡œì íŠ¸ ê·¸ë¦¬ë“œ
```typescript
// src/components/project/VirtualizedProjectGrid.tsx
import { FixedSizeGrid as Grid } from 'react-window';
import { AutoSizer } from 'react-virtualized-auto-sizer';
import InfiniteLoader from 'react-window-infinite-loader';

interface VirtualizedProjectGridProps {
  projects: Project[];
  onLoadMore: () => void;
  hasMore: boolean;
  isLoadingMore: boolean;
}

const VirtualizedProjectGrid: React.FC<VirtualizedProjectGridProps> = ({
  projects,
  onLoadMore,
  hasMore,
  isLoadingMore
}) => {
  const COLUMN_COUNT = 3;
  const ITEM_HEIGHT = 320;
  const ITEM_WIDTH = 400;
  const GAP = 24;
  
  const rowCount = Math.ceil(projects.length / COLUMN_COUNT);
  const itemCount = hasMore ? projects.length + COLUMN_COUNT : projects.length;
  
  const isItemLoaded = (index: number) => !hasMore || index < projects.length;
  
  const Cell = ({ columnIndex, rowIndex, style }: any) => {
    const index = rowIndex * COLUMN_COUNT + columnIndex;
    const project = projects[index];
    
    if (!project) {
      return (
        <div style={style}>
          {isLoadingMore && <ProjectCardSkeleton />}
        </div>
      );
    }
    
    return (
      <div
        style={{
          ...style,
          left: (style.left as number) + GAP / 2,
          top: (style.top as number) + GAP / 2,
          width: (style.width as number) - GAP,
          height: (style.height as number) - GAP
        }}
      >
        <ProjectCard
          project={project}
          mode="grid"
          showActions
          onView={handleProjectView}
          onEdit={handleProjectEdit}
        />
      </div>
    );
  };
  
  return (
    <div className="h-[800px]">
      <AutoSizer>
        {({ height, width }) => (
          <InfiniteLoader
            isItemLoaded={isItemLoaded}
            itemCount={itemCount}
            loadMoreItems={onLoadMore}
            threshold={3}
          >
            {({ onItemsRendered, ref }) => (
              <Grid
                ref={ref}
                height={height}
                width={width}
                columnCount={COLUMN_COUNT}
                columnWidth={ITEM_WIDTH + GAP}
                rowCount={rowCount}
                rowHeight={ITEM_HEIGHT + GAP}
                onItemsRendered={({
                  visibleColumnStartIndex,
                  visibleColumnStopIndex,
                  visibleRowStartIndex,
                  visibleRowStopIndex
                }) => {
                  onItemsRendered({
                    overscanStartIndex: visibleRowStartIndex * COLUMN_COUNT,
                    overscanStopIndex: visibleRowStopIndex * COLUMN_COUNT + COLUMN_COUNT - 1,
                    visibleStartIndex: visibleRowStartIndex * COLUMN_COUNT,
                    visibleStopIndex: visibleRowStopIndex * COLUMN_COUNT + COLUMN_COUNT - 1
                  });
                }}
              >
                {Cell}
              </Grid>
            )}
          </InfiniteLoader>
        )}
      </AutoSizer>
    </div>
  );
};
```

#### 2. ìµœì í™”ëœ ì´ë¯¸ì§€ ì»´í¬ë„ŒíŠ¸
```typescript
// src/components/ui/OptimizedImage.tsx
interface OptimizedImageProps {
  src: string;
  alt: string;
  width?: number;
  height?: number;
  className?: string;
  priority?: boolean;
  sizes?: string;
  placeholder?: 'blur' | 'empty';
  blurDataURL?: string;
}

const OptimizedImage: React.FC<OptimizedImageProps> = ({
  src,
  alt,
  width = 400,
  height = 300,
  className = '',
  priority = false,
  sizes = '(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw',
  placeholder = 'blur',
  blurDataURL
}) => {
  const [isLoaded, setIsLoaded] = useState(false);
  const [hasError, setHasError] = useState(false);
  const imgRef = useRef<HTMLImageElement>(null);
  
  // Intersection Observer for lazy loading
  useEffect(() => {
    if (priority) return;
    
    const img = imgRef.current;
    if (!img) return;
    
    const observer = new IntersectionObserver(
      ([entry]) => {
        if (entry.isIntersecting) {
          img.src = img.dataset.src!;
          observer.unobserve(img);
        }
      },
      { rootMargin: '50px' }
    );
    
    observer.observe(img);
    
    return () => observer.disconnect();
  }, [priority]);
  
  // WebP ì§€ì› ê°ì§€
  const supportsWebP = useMemo(() => {
    const canvas = document.createElement('canvas');
    canvas.width = 1;
    canvas.height = 1;
    return canvas.toDataURL('image/webp').indexOf('data:image/webp') === 0;
  }, []);
  
  const getOptimizedSrc = (src: string, width: number, format?: string) => {
    const params = new URLSearchParams();
    params.set('width', width.toString());
    params.set('height', height.toString());
    params.set('fit', 'cover');
    params.set('quality', '85');
    
    if (format) {
      params.set('format', format);
    }
    
    return `${src}?${params.toString()}`;
  };
  
  const srcSet = useMemo(() => {
    const format = supportsWebP ? 'webp' : 'jpeg';
    return [
      `${getOptimizedSrc(src, width / 2, format)} ${width / 2}w`,
      `${getOptimizedSrc(src, width, format)} ${width}w`,
      `${getOptimizedSrc(src, width * 2, format)} ${width * 2}w`
    ].join(', ');
  }, [src, width, height, supportsWebP]);
  
  if (hasError) {
    return (
      <div 
        className={`flex items-center justify-center bg-gray-100 ${className}`}
        style={{ width, height }}
      >
        <div className="text-center text-gray-500">
          <ImageIcon className="w-8 h-8 mx-auto mb-2" />
          <p className="text-sm">ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</p>
        </div>
      </div>
    );
  }
  
  return (
    <div className={`relative overflow-hidden ${className}`}>
      {/* ë¸”ëŸ¬ í”Œë ˆì´ìŠ¤í™€ë” */}
      {placeholder === 'blur' && !isLoaded && (
        <div 
          className="absolute inset-0 bg-gray-200 animate-pulse"
          style={{
            backgroundImage: blurDataURL ? `url(${blurDataURL})` : undefined,
            backgroundSize: 'cover',
            backgroundPosition: 'center'
          }}
        />
      )}
      
      {/* WebP ì§€ì› ì‹œ picture ìš”ì†Œ ì‚¬ìš© */}
      {supportsWebP ? (
        <picture>
          <source
            srcSet={srcSet.replace(/jpeg/g, 'webp')}
            sizes={sizes}
            type="image/webp"
          />
          <source
            srcSet={srcSet}
            sizes={sizes}
            type="image/jpeg"
          />
          <img
            ref={imgRef}
            src={priority ? getOptimizedSrc(src, width) : undefined}
            data-src={!priority ? getOptimizedSrc(src, width) : undefined}
            alt={alt}
            width={width}
            height={height}
            loading={priority ? 'eager' : 'lazy'}
            decoding="async"
            onLoad={() => setIsLoaded(true)}
            onError={() => setHasError(true)}
            className={`transition-opacity duration-300 ${
              isLoaded ? 'opacity-100' : 'opacity-0'
            }`}
          />
        </picture>
      ) : (
        <img
          ref={imgRef}
          src={priority ? getOptimizedSrc(src, width) : undefined}
          data-src={!priority ? getOptimizedSrc(src, width) : undefined}
          srcSet={srcSet}
          sizes={sizes}
          alt={alt}
          width={width}
          height={height}
          loading={priority ? 'eager' : 'lazy'}
          decoding="async"
          onLoad={() => setIsLoaded(true)}
          onError={() => setHasError(true)}
          className={`transition-opacity duration-300 ${
            isLoaded ? 'opacity-100' : 'opacity-0'
          }`}
        />
      )}
    </div>
  );
};
```

#### 3. ê³ ì„±ëŠ¥ ì˜ê²¬ ì‹œìŠ¤í…œ
```typescript
// src/components/opinion/OpinionSystem.tsx
interface OpinionSystemProps {
  projectId: string;
  stageId?: string;
  currentUser: User;
  className?: string;
}

const OpinionSystem: React.FC<OpinionSystemProps> = ({
  projectId,
  stageId,
  currentUser,
  className = ''
}) => {
  const [selectedCategory, setSelectedCategory] = useState<string>('all');
  const [sortBy, setSortBy] = useState<'newest' | 'oldest' | 'popular'>('newest');
  const [showResolved, setShowResolved] = useState(false);
  
  // ì‹¤ì‹œê°„ ì˜ê²¬ êµ¬ë…
  const { 
    data: opinions, 
    isLoading,
    hasNextPage,
    fetchNextPage 
  } = useInfiniteOpinions({
    projectId,
    stageId,
    category: selectedCategory === 'all' ? undefined : selectedCategory,
    sortBy,
    includeResolved: showResolved,
    pageSize: 20
  });
  
  // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ êµ¬ë…
  useRealtimeOpinions(projectId, {
    onOpinionAdded: (opinion) => {
      toast.success(`ìƒˆ ì˜ê²¬ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤: ${opinion.title}`);
    },
    onOpinionUpdated: (opinion) => {
      if (opinion.status === 'resolved') {
        toast.info(`ì˜ê²¬ì´ í•´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤: ${opinion.title}`);
      }
    }
  });
  
  const allOpinions = useMemo(() => {
    return opinions?.pages.flatMap(page => page.opinions) || [];
  }, [opinions]);
  
  const opinionStats = useMemo(() => {
    const total = allOpinions.length;
    const open = allOpinions.filter(o => o.status === 'open').length;
    const inReview = allOpinions.filter(o => o.status === 'in_review').length;
    const resolved = allOpinions.filter(o => o.status === 'resolved').length;
    
    return { total, open, inReview, resolved };
  }, [allOpinions]);
  
  return (
    <div className={`space-y-6 ${className}`}>
      {/* ì˜ê²¬ í†µê³„ */}
      <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
        <StatCard
          title="ì „ì²´ ì˜ê²¬"
          value={opinionStats.total}
          icon={MessageSquareIcon}
          color="blue"
        />
        <StatCard
          title="ë¯¸í•´ê²°"
          value={opinionStats.open}
          icon={AlertCircleIcon}
          color="red"
        />
        <StatCard
          title="ê²€í† ì¤‘"
          value={opinionStats.inReview}
          icon={ClockIcon}
          color="yellow"
        />
        <StatCard
          title="í•´ê²°ë¨"
          value={opinionStats.resolved}
          icon={CheckCircleIcon}
          color="green"
        />
      </div>
      
      {/* í•„í„° ë° ì •ë ¬ */}
      <div className="flex flex-col sm:flex-row gap-4 items-center justify-between">
        <div className="flex flex-wrap gap-2">
          <OpinionCategoryFilter
            selected={selectedCategory}
            onChange={setSelectedCategory}
          />
          <ToggleSwitch
            checked={showResolved}
            onChange={setShowResolved}
            label="í•´ê²°ëœ ì˜ê²¬ í¬í•¨"
          />
        </div>
        
        <div className="flex gap-2">
          <SortDropdown
            value={sortBy}
            onChange={setSortBy}
            options={[
              { value: 'newest', label: 'ìµœì‹ ìˆœ' },
              { value: 'oldest', label: 'ì˜¤ë˜ëœìˆœ' },
              { value: 'popular', label: 'ì¸ê¸°ìˆœ' }
            ]}
          />
          <OpinionFormModal
            projectId={projectId}
            stageId={stageId}
            currentUser={currentUser}
            trigger={
              <Button>
                <PlusIcon className="w-4 h-4 mr-2" />
                ì˜ê²¬ ì‘ì„±
              </Button>
            }
          />
        </div>
      </div>
      
      {/* ì˜ê²¬ ëª©ë¡ */}
      <div className="space-y-4">
        {isLoading ? (
          Array.from({ length: 3 }).map((_, i) => (
            <OpinionCardSkeleton key={i} />
          ))
        ) : allOpinions.length === 0 ? (
          <EmptyState
            title="ì˜ê²¬ì´ ì—†ìŠµë‹ˆë‹¤"
            description="ì²« ë²ˆì§¸ ì˜ê²¬ì„ ì‘ì„±í•´ë³´ì„¸ìš”."
            icon={MessageSquareIcon}
          />
        ) : (
          <VirtualizedOpinionList
            opinions={allOpinions}
            currentUser={currentUser}
            onLoadMore={fetchNextPage}
            hasMore={hasNextPage}
          />
        )}
      </div>
    </div>
  );
};
```

---

## ğŸ”§ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§

### ê³ ë„í™”ëœ ì§„í–‰ë¥  ê³„ì‚° ì‹œìŠ¤í…œ

#### ê°€ì¤‘ì¹˜ ê¸°ë°˜ ì§„í–‰ë¥  ê³„ì‚°
```typescript
// src/utils/progressCalculation.ts
interface FieldDefinition {
  key: string;
  type: 'date' | 'text' | 'checkbox' | 'file' | 'number';
  weight: number; // ê°€ì¤‘ì¹˜ (0.1 ~ 2.0)
  required: boolean;
  dependencies?: string[]; // ì˜ì¡´ì„± í•„ë“œ
  validationRules?: ValidationRule[];
}

interface ValidationRule {
  type: 'min' | 'max' | 'pattern' | 'custom';
  value: any;
  message: string;
}

// ë‹¨ê³„ë³„ í•„ë“œ ì •ì˜ (ê°€ì¤‘ì¹˜ í¬í•¨)
const STAGE_FIELD_DEFINITIONS: Record<number, FieldDefinition[]> = {
  1: [
    { key: 'productGroup', type: 'text', weight: 1.0, required: true },
    { key: 'manufacturer', type: 'text', weight: 1.0, required: true },
    { key: 'vendor', type: 'text', weight: 0.8, required: false },
    { key: 'derivativeModel', type: 'text', weight: 0.6, required: false },
    { 
      key: 'launchDate', 
      type: 'date', 
      weight: 1.5, 
      required: true,
      validationRules: [
        { type: 'min', value: new Date(), message: 'ì¶œì‹œì¼ì€ í˜„ì¬ ë‚ ì§œ ì´í›„ì—¬ì•¼ í•©ë‹ˆë‹¤' }
      ]
    },
    { key: 'launchDateExecuted', type: 'checkbox', weight: 1.5, required: false },
    { 
      key: 'massProductionDate', 
      type: 'date', 
      weight: 2.0, 
      required: true,
      dependencies: ['launchDate'],
      validationRules: [
        { type: 'custom', value: 'beforeLaunchDate', message: 'ì–‘ì‚°ì¼ì€ ì¶œì‹œì¼ë³´ë‹¤ ë¹¨ë¼ì•¼ í•©ë‹ˆë‹¤' }
      ]
    },
    { key: 'massProductionDateExecuted', type: 'checkbox', weight: 2.0, required: false },
    { key: 'productManager', type: 'text', weight: 1.2, required: true },
    { key: 'mechanicalEngineer', type: 'text', weight: 1.0, required: true },
    { key: 'circuitEngineer', type: 'text', weight: 1.0, required: true },
    { key: 'estimatedBudget', type: 'number', weight: 0.8, required: false },
    { key: 'targetMarket', type: 'text', weight: 0.6, required: false }
  ],
  2: [
    { key: 'pilotProductionDate', type: 'date', weight: 1.5, required: true },
    { key: 'pilotProductionDateExecuted', type: 'checkbox', weight: 1.5, required: false },
    { key: 'pilotQuantity', type: 'number', weight: 1.0, required: true },
    { key: 'techTransferDate', type: 'date', weight: 1.8, required: true },
    { key: 'techTransferDateExecuted', type: 'checkbox', weight: 1.8, required: false },
    { key: 'installationParty', type: 'text', weight: 1.0, required: true },
    { key: 'serviceParty', type: 'text', weight: 1.0, required: true },
    { key: 'trainingDate', type: 'date', weight: 1.2, required: true },
    { key: 'trainingDateExecuted', type: 'checkbox', weight: 1.2, required: false },
    { key: 'userManualUpload', type: 'file', weight: 1.5, required: true },
    { key: 'techManualUpload', type: 'file', weight: 1.5, required: true },
    { key: 'userManualUploaded', type: 'checkbox', weight: 1.5, required: false },
    { key: 'techManualUploaded', type: 'checkbox', weight: 1.5, required: false },
    { key: 'equipmentReadiness', type: 'number', weight: 1.3, required: true },
    { key: 'materialReadiness', type: 'number', weight: 1.3, required: true },
    { key: 'personnelReadiness', type: 'number', weight: 1.1, required: true }
  ],
  3: [
    { key: 'bomManager', type: 'text', weight: 1.2, required: true },
    { key: 'bomCompletionDate', type: 'date', weight: 2.0, required: true },
    { key: 'bomCompletionDateExecuted', type: 'checkbox', weight: 2.0, required: false },
    { key: 'bomVersion', type: 'text', weight: 1.0, required: true },
    { key: 'priceManager', type: 'text', weight: 1.2, required: true },
    { key: 'priceRegistrationDate', type: 'date', weight: 1.8, required: true },
    { key: 'priceRegistrationDateExecuted', type: 'checkbox', weight: 1.8, required: false },
    { key: 'targetPrice', type: 'number', weight: 1.5, required: true },
    { key: 'firstPartsOrderDate', type: 'date', weight: 1.6, required: true },
    { key: 'firstPartsOrderDateExecuted', type: 'checkbox', weight: 1.6, required: false },
    { key: 'partsReceiptDate', type: 'date', weight: 1.4, required: true },
    { key: 'partsReceiptDateExecuted', type: 'checkbox', weight: 1.4, required: false },
    { key: 'partsReceiptManager', type: 'text', weight: 1.0, required: true },
    { key: 'branchOrderGuideDate', type: 'date', weight: 1.3, required: true },
    { key: 'branchOrderGuideDateExecuted', type: 'checkbox', weight: 1.3, required: false }
  ]
};

export const calculateStageProgress = (stageData: any, stageNumber: number): number => {
  const fields = STAGE_FIELD_DEFINITIONS[stageNumber] || [];
  let totalWeight = 0;
  let achievedWeight = 0;
  let validationErrors: string[] = [];
  
  fields.forEach(field => {
    const value = stageData[field.key];
    totalWeight += field.weight;
    
    // í•„ë“œ ìœ íš¨ì„± ê²€ì‚¬
    const isValid = validateField(field, value, stageData);
    if (!isValid.valid) {
      validationErrors.push(isValid.error!);
    }
    
    // ì§„í–‰ë¥  ê³„ì‚°
    switch (field.type) {
      case 'date':
        if (value && value.trim() !== '') {
          achievedWeight += field.weight * 0.5; // ë‚ ì§œ ì…ë ¥ 50%
          
          // ì‹¤í–‰ ì™„ë£Œ ì²´í¬
          const executedKey = `${field.key}Executed`;
          if (stageData[executedKey] === true) {
            achievedWeight += field.weight * 0.5; // ì‹¤í–‰ ì™„ë£Œ 50%
          }
        }
        break;
        
      case 'checkbox':
        if (value === true) {
          achievedWeight += field.weight;
        }
        break;
        
      case 'file':
        if (value && value.trim() !== '') {
          achievedWeight += field.weight * 0.7; // íŒŒì¼ ì—…ë¡œë“œ 70%
          
          // ì—…ë¡œë“œ ì™„ë£Œ ì²´í¬
          const uploadedKey = `${field.key}ed`; // userManualUpload -> userManualUploaded
          if (stageData[uploadedKey] === true) {
            achievedWeight += field.weight * 0.3; // ì—…ë¡œë“œ í™•ì¸ 30%
          }
        }
        break;
        
      case 'number':
        if (typeof value === 'number' && value >= 0) {
          // ìˆ«ì í•„ë“œëŠ” 0-100% ë²”ìœ„ë¡œ ê³„ì‚°
          const percentage = field.key.includes('Readiness') ? value / 100 : 1;
          achievedWeight += field.weight * Math.min(percentage, 1);
        }
        break;
        
      default: // text
        if (value && value.trim() !== '') {
          achievedWeight += field.weight;
        }
        break;
    }
  });
  
  const progress = totalWeight > 0 ? Math.round((achievedWeight / totalWeight) * 100) : 0;
  
  // ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨ ì‹œ ì§„í–‰ë¥  í˜ë„í‹°
  if (validationErrors.length > 0) {
    const penalty = Math.min(validationErrors.length * 5, 25); // ìµœëŒ€ 25% í˜ë„í‹°
    return Math.max(progress - penalty, 0);
  }
  
  return Math.min(progress, 100);
};

// í•„ë“œ ìœ íš¨ì„± ê²€ì‚¬
const validateField = (field: FieldDefinition, value: any, allData: any): { valid: boolean; error?: string } => {
  // í•„ìˆ˜ í•„ë“œ ê²€ì‚¬
  if (field.required && (!value || (typeof value === 'string' && value.trim() === ''))) {
    return { valid: false, error: `${field.key}ëŠ” í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.` };
  }
  
  // ì˜ì¡´ì„± ê²€ì‚¬
  if (field.dependencies) {
    for (const dep of field.dependencies) {
      if (!allData[dep] || (typeof allData[dep] === 'string' && allData[dep].trim() === '')) {
        return { valid: false, error: `${field.key}ë¥¼ ì…ë ¥í•˜ë ¤ë©´ ë¨¼ì € ${dep}ë¥¼ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.` };
      }
    }
  }
  
  // ì»¤ìŠ¤í…€ ìœ íš¨ì„± ê²€ì‚¬
  if (field.validationRules) {
    for (const rule of field.validationRules) {
      if (rule.type === 'custom' && rule.value === 'beforeLaunchDate') {
        const launchDate = new Date(allData.launchDate);
        const massDate = new Date(value);
        if (massDate >= launchDate) {
          return { valid: false, error: rule.message };
        }
      }
    }
  }
  
  return { valid: true };
};

// í”„ë¡œì íŠ¸ ì „ì²´ ì§„í–‰ë¥  (ê°€ì¤‘ í‰ê· )
export const calculateProjectProgress = (project: Project): ProjectProgress => {
  const stage1Progress = calculateStageProgress(project.stage1 || {}, 1);
  const stage2Progress = calculateStageProgress(project.stage2 || {}, 2);
  const stage3Progress = calculateStageProgress(project.stage3 || {}, 3);
  
  // ë‹¨ê³„ë³„ ê°€ì¤‘ì¹˜ (í›„ë°˜ë¶€ ë‹¨ê³„ì¼ìˆ˜ë¡ ë†’ì€ ê°€ì¤‘ì¹˜)
  const weights = { stage1: 0.2, stage2: 0.3, stage3: 0.5 };
  
  const overall = Math.round(
    (stage1Progress * weights.stage1 + 
     stage2Progress * weights.stage2 + 
     stage3Progress * weights.stage3) / 
    (weights.stage1 + weights.stage2 + weights.stage3) * 100
  ) / 100;
  
  return {
    overall: Math.round(overall),
    stage1: stage1Progress,
    stage2: stage2Progress,
    stage3: stage3Progress,
    breakdown: {
      stage1Weight: weights.stage1,
      stage2Weight: weights.stage2,
      stage3Weight: weights.stage3
    }
  };
};
```

### D-Day ë° ì¼ì • ê´€ë¦¬ ì‹œìŠ¤í…œ

#### ì§€ëŠ¥í˜• D-Day ê³„ì‚°
```typescript
// src/utils/dateCalculation.ts
interface DateCalculationOptions {
  excludeWeekends?: boolean;
  excludeHolidays?: boolean;
  workingHoursOnly?: boolean;
  timeZone?: string;
}

interface DDayResult {
  dDay: number;
  status: DDayStatus;
  workingDays?: number;
  isOverdue: boolean;
  criticalPath?: CriticalPathInfo;
}

interface CriticalPathInfo {
  remainingTasks: string[];
  estimatedCompletionDate: Date;
  riskLevel: 'low' | 'medium' | 'high';
}

// í•œêµ­ ê³µíœ´ì¼ ë°ì´í„°
const KOREAN_HOLIDAYS_2024: Record<string, string> = {
  '2024-01-01': 'ì‹ ì •',
  '2024-02-09': 'ì„¤ë‚ ì—°íœ´',
  '2024-02-10': 'ì„¤ë‚ ',
  '2024-02-11': 'ì„¤ë‚ ì—°íœ´',
  '2024-02-12': 'ëŒ€ì²´ê³µíœ´ì¼',
  '2024-03-01': 'ì‚¼ì¼ì ˆ',
  '2024-04-10': 'êµ­íšŒì˜ì›ì„ ê±°',
  '2024-05-05': 'ì–´ë¦°ì´ë‚ ',
  '2024-05-06': 'ëŒ€ì²´ê³µíœ´ì¼',
  '2024-05-15': 'ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ',
  '2024-06-06': 'í˜„ì¶©ì¼',
  '2024-08-15': 'ê´‘ë³µì ˆ',
  '2024-09-16': 'ì¶”ì„ì—°íœ´',
  '2024-09-17': 'ì¶”ì„',
  '2024-09-18': 'ì¶”ì„ì—°íœ´',
  '2024-10-03': 'ê°œì²œì ˆ',
  '2024-10-09': 'í•œê¸€ë‚ ',
  '2024-12-25': 'í¬ë¦¬ìŠ¤ë§ˆìŠ¤'
};

export const calculateAdvancedDDay = (
  targetDate: string | Date,
  options: DateCalculationOptions = {}
): DDayResult => {
  const target = new Date(targetDate);
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  target.setHours(0, 0, 0, 0);
  
  const diffTime = target.getTime() - today.getTime();
  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
  
  let workingDays = diffDays;
  
  // ì˜ì—…ì¼ ê³„ì‚°
  if (options.excludeWeekends || options.excludeHolidays) {
    workingDays = calculateWorkingDays(today, target, options);
  }
  
  const status = getDDayStatus(diffDays);
  const isOverdue = diffDays < 0;
  
  return {
    dDay: diffDays,
    status,
    workingDays: options.excludeWeekends || options.excludeHolidays ? workingDays : undefined,
    isOverdue,
    criticalPath: calculateCriticalPath(target, diffDays)
  };
};

const calculateWorkingDays = (
  startDate: Date,
  endDate: Date,
  options: DateCalculationOptions
): number => {
  let workingDays = 0;
  const current = new Date(startDate);
  
  while (current <= endDate) {
    const dayOfWeek = current.getDay();
    const dateStr = current.toISOString().split('T')[0];
    
    // ì£¼ë§ ì œì™¸
    const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
    if (options.excludeWeekends && isWeekend) {
      current.setDate(current.getDate() + 1);
      continue;
    }
    
    // ê³µíœ´ì¼ ì œì™¸
    const isHoliday = KOREAN_HOLIDAYS_2024[dateStr];
    if (options.excludeHolidays && isHoliday) {
      current.setDate(current.getDate() + 1);
      continue;
    }
    
    workingDays++;
    current.setDate(current.getDate() + 1);
  }
  
  return workingDays;
};

const calculateCriticalPath = (targetDate: Date, daysRemaining: number): CriticalPathInfo => {
  // ë‚¨ì€ ì‘ì—…ë“¤ì˜ ìš°ì„ ìˆœìœ„ì™€ ì˜ˆìƒ ì†Œìš”ì‹œê°„
  const remainingTasks = [];
  let riskLevel: 'low' | 'medium' | 'high' = 'low';
  
  if (daysRemaining < 0) {
    riskLevel = 'high';
    remainingTasks.push('í”„ë¡œì íŠ¸ê°€ ì´ë¯¸ ì§€ì—°ë˜ì—ˆìŠµë‹ˆë‹¤');
  } else if (daysRemaining <= 7) {
    riskLevel = 'high';
    remainingTasks.push('ì¦‰ì‹œ ì™„ë£Œ í•„ìš”í•œ ì‘ì—…ë“¤ì„ í™•ì¸í•˜ì„¸ìš”');
  } else if (daysRemaining <= 30) {
    riskLevel = 'medium';
    remainingTasks.push('ì£¼ìš” ë§ˆì¼ìŠ¤í†¤ ì ê²€ì´ í•„ìš”í•©ë‹ˆë‹¤');
  }
  
  const estimatedCompletionDate = new Date(targetDate);
  if (riskLevel === 'high') {
    estimatedCompletionDate.setDate(estimatedCompletionDate.getDate() + 7); // 1ì£¼ ì§€ì—° ì˜ˆìƒ
  }
  
  return {
    remainingTasks,
    estimatedCompletionDate,
    riskLevel
  };
};

export const getDDayStatus = (dDay: number): DDayStatus => {
  if (dDay < 0) {
    return {
      type: 'overdue',
      text: `D+${Math.abs(dDay)}`,
      color: 'red',
      bgColor: 'bg-red-50',
      textColor: 'text-red-700',
      borderColor: 'border-red-200',
      emoji: 'ğŸš¨',
      urgency: 'critical'
    };
  } else if (dDay === 0) {
    return {
      type: 'today',
      text: 'D-DAY',
      color: 'orange',
      bgColor: 'bg-orange-50',
      textColor: 'text-orange-700',
      borderColor: 'border-orange-200',
      emoji: 'âš¡',
      urgency: 'critical'
    };
  } else if (dDay <= 3) {
    return {
      type: 'critical',
      text: `D-${dDay}`,
      color: 'red',
      bgColor: 'bg-red-50',
      textColor: 'text-red-700',
      borderColor: 'border-red-200',
      emoji: 'ğŸ”¥',
      urgency: 'high'
    };
  } else if (dDay <= 7) {
    return {
      type: 'urgent',
      text: `D-${dDay}`,
      color: 'yellow',
      bgColor: 'bg-yellow-50',
      textColor: 'text-yellow-700',
      borderColor: 'border-yellow-200',
      emoji: 'âš ï¸',
      urgency: 'high'
    };
  } else if (dDay <= 30) {
    return {
      type: 'soon',
      text: `D-${dDay}`,
      color: 'blue',
      bgColor: 'bg-blue-50',
      textColor: 'text-blue-700',
      borderColor: 'border-blue-200',
      emoji: 'ğŸ“…',
      urgency: 'medium'
    };
  } else {
    return {
      type: 'normal',
      text: `D-${dDay}`,
      color: 'gray',
      bgColor: 'bg-gray-50',
      textColor: 'text-gray-700',
      borderColor: 'border-gray-200',
      emoji: 'ğŸ“',
      urgency: 'low'
    };
  }
};
```

---

## ğŸ” ì¸ì¦ ë° ê¶Œí•œ ì‹œìŠ¤í…œ

### ê³ ë„í™”ëœ ì¸ì¦ ì‹œìŠ¤í…œ

#### 2ë‹¨ê³„ ì¸ì¦ (MFA) ì§€ì›
```typescript
// src/hooks/useAuth.ts
interface AuthState {
  user: User | null;
  profile: Profile | null;
  loading: boolean;
  mfaRequired: boolean;
  mfaSetupRequired: boolean;
}

export const useAuth = () => {
  const [authState, setAuthState] = useState<AuthState>({
    user: null,
    profile: null,
    loading: true,
    mfaRequired: false,
    mfaSetupRequired: false
  });
  
  // ì„¸ì…˜ ì§€ì†ì„± ê´€ë¦¬
  useEffect(() => {
    let refreshTimer: NodeJS.Timeout;
    
    const setupSession = async () => {
      const { data: { session }, error } = await supabase.auth.getSession();
      
      if (session?.user) {
        await handleUserSession(session.user);
        
        // í† í° ìë™ ê°±ì‹  ì„¤ì •
        const expiresAt = session.expires_at;
        if (expiresAt) {
          const refreshTime = (expiresAt * 1000) - Date.now() - (5 * 60 * 1000); // 5ë¶„ ì „ ê°±ì‹ 
          refreshTimer = setTimeout(async () => {
            await supabase.auth.refreshSession();
          }, refreshTime);
        }
      }
      
      setAuthState(prev => ({ ...prev, loading: false }));
    };
    
    setupSession();
    
    // ì¸ì¦ ìƒíƒœ ë³€ê²½ ê°ì§€
    const { data: { subscription } } = supabase.auth.onAuthStateChange(
      async (event, session) => {
        console.log('Auth event:', event);
        
        if (session?.user) {
          await handleUserSession(session.user);
        } else {
          setAuthState({
            user: null,
            profile: null,
            loading: false,
            mfaRequired: false,
            mfaSetupRequired: false
          });
        }
      }
    );
    
    return () => {
      subscription.unsubscribe();
      if (refreshTimer) clearTimeout(refreshTimer);
    };
  }, []);
  
  const handleUserSession = async (user: any) => {
    try {
      // ì‚¬ìš©ì í”„ë¡œí•„ ì¡°íšŒ
      const { data: profile, error: profileError } = await supabase
        .from('profiles')
        .select('*')
        .eq('id', user.id)
        .single();
      
      if (profileError && profileError.code === 'PGRST116') {
        // í”„ë¡œí•„ì´ ì—†ìœ¼ë©´ ìƒì„±
        const newProfile = await createUserProfile(user);
        setAuthState(prev => ({
          ...prev,
          user,
          profile: newProfile,
          mfaSetupRequired: !user.user_metadata?.mfa_enabled
        }));
      } else if (profile) {
        // ë¡œê·¸ì¸ í†µê³„ ì—…ë°ì´íŠ¸
        await updateLoginStats(user.id);
        
        setAuthState(prev => ({
          ...prev,
          user,
          profile,
          mfaRequired: false,
          mfaSetupRequired: profile.role === 'admin' && !user.user_metadata?.mfa_enabled
        }));
      }
    } catch (error) {
      console.error('Session handling error:', error);
      setAuthState(prev => ({ ...prev, loading: false }));
    }
  };
  
  const signIn = async (email: string, password: string, mfaCode?: string) => {
    try {
      const { data, error } = await supabase.auth.signInWithPassword({
        email,
        password
      });
      
      if (error) {
        if (error.message.includes('MFA')) {
          setAuthState(prev => ({ ...prev, mfaRequired: true }));
          return { data: null, error, requiresMFA: true };
        }
        throw error;
      }
      
      // MFA ì½”ë“œ ê²€ì¦
      if (mfaCode && data.user) {
        const { error: mfaError } = await supabase.auth.mfa.verify({
          factorId: data.user.user_metadata.mfa_factor_id,
          challengeId: data.user.user_metadata.mfa_challenge_id,
          code: mfaCode
        });
        
        if (mfaError) {
          throw mfaError;
        }
      }
      
      // í™œë™ ë¡œê·¸ ê¸°ë¡
      await logActivity('user_login', {
        method: 'email_password',
        ip_address: await getClientIP(),
        user_agent: navigator.userAgent
      });
      
      return { data, error: null, requiresMFA: false };
    } catch (error) {
      console.error('Sign in error:', error);
      return { data: null, error, requiresMFA: false };
    }
  };
  
  const setupMFA = async (phoneNumber: string) => {
    try {
      const { data, error } = await supabase.auth.mfa.enroll({
        factorType: 'totp',
        friendlyName: 'Authenticator App'
      });
      
      if (error) throw error;
      
      // QR ì½”ë“œ ìƒì„±ì„ ìœ„í•œ ì •ë³´ ë°˜í™˜
      return {
        qrCode: data.totp.qr_code,
        secret: data.totp.secret,
        factorId: data.id
      };
    } catch (error) {
      console.error('MFA setup error:', error);
      throw error;
    }
  };
  
  const verifyMFA = async (factorId: string, code: string) => {
    try {
      const { data, error } = await supabase.auth.mfa.verify({
        factorId,
        challengeId: '', // ì„¤ì • ì¤‘ì—ëŠ” ë¹ˆ ê°’
        code
      });
      
      if (error) throw error;
      
      // ì‚¬ìš©ì ë©”íƒ€ë°ì´í„° ì—…ë°ì´íŠ¸
      await supabase.auth.updateUser({
        data: { mfa_enabled: true, mfa_factor_id: factorId }
      });
      
      setAuthState(prev => ({ ...prev, mfaSetupRequired: false }));
      
      return { success: true };
    } catch (error) {
      console.error('MFA verification error:', error);
      throw error;
    }
  };
  
  const signOut = async () => {
    try {
      // í™œë™ ë¡œê·¸ ê¸°ë¡ (ë¡œê·¸ì•„ì›ƒ ì „)
      await logActivity('user_logout', {
        session_duration: calculateSessionDuration()
      });
      
      const { error } = await supabase.auth.signOut();
      if (error) throw error;
      
      // ë¡œì»¬ ìƒíƒœ ì´ˆê¸°í™”
      setAuthState({
        user: null,
        profile: null,
        loading: false,
        mfaRequired: false,
        mfaSetupRequired: false
      });
      
      // ìºì‹œ ì •ë¦¬
      queryClient.clear();
      
    } catch (error) {
      console.error('Sign out error:', error);
    }
  };
  
  return {
    ...authState,
    signIn,
    signOut,
    setupMFA,
    verifyMFA,
    updateProfile: useCallback(async (updates: Partial<Profile>) => {
      // í”„ë¡œí•„ ì—…ë°ì´íŠ¸ ë¡œì§
    }, [])
  };
};

// ë³´ì¡° í•¨ìˆ˜ë“¤
const createUserProfile = async (user: any): Promise<Profile> => {
  const { data, error } = await supabase
    .from('profiles')
    .insert({
      id: user.id,
      name: user.user_metadata?.name || user.email?.split('@')[0],
      team: user.user_metadata?.team || '',
      department: user.user_metadata?.department || '',
      role: 'user', // ê¸°ë³¸ ì—­í• 
      preferences: {
        theme: 'light',
        language: 'ko',
        notifications: {
          email: true,
          browser: true,
          mentions: true
        }
      }
    })
    .select()
    .single();
  
  if (error) throw error;
  return data;
};

const updateLoginStats = async (userId: string) => {
  await supabase
    .from('profiles')
    .update({
      last_login_at: new Date().toISOString(),
      login_count: supabase.raw('login_count + 1')
    })
    .eq('id', userId);
};
```

### ì„¸ë°€í•œ ê¶Œí•œ ê´€ë¦¬ ì‹œìŠ¤í…œ

#### ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´ (RBAC)
```typescript
// src/hooks/usePermissions.ts
interface Permission {
  resource: string;
  action: 'create' | 'read' | 'update' | 'delete' | 'manage';
  conditions?: PermissionCondition[];
}

interface PermissionCondition {
  field: string;
  operator: 'eq' | 'ne' | 'in' | 'not_in' | 'gt' | 'lt';
  value: any;
}

interface Role {
  name: string;
  permissions: Permission[];
  inherits?: string[]; // ìƒì†ë°›ëŠ” ì—­í• ë“¤
}

// ì—­í• ë³„ ê¶Œí•œ ì •ì˜
const ROLE_DEFINITIONS: Record<string, Role> = {
  user: {
    name: 'user',
    permissions: [
      { resource: 'projects', action: 'read' },
      { resource: 'projects', action: 'create' },
      { 
        resource: 'projects', 
        action: 'update',
        conditions: [{ field: 'created_by', operator: 'eq', value: 'current_user' }]
      },
      { resource: 'opinions', action: 'create' },
      { resource: 'opinions', action: 'read' },
      {
        resource: 'opinions',
        action: 'update',
        conditions: [{ field: 'author_id', operator: 'eq', value: 'current_user' }]
      }
    ]
  },
  
  manager: {
    name: 'manager',
    inherits: ['user'],
    permissions: [
      { resource: 'projects', action: 'update' }, // ëª¨ë“  í”„ë¡œì íŠ¸ ìˆ˜ì • ê°€ëŠ¥
      { resource: 'projects', action: 'delete' },
      { resource: 'users', action: 'read' },
      { resource: 'reports', action: 'read' },
      { resource: 'reports', action: 'create' }
    ]
  },
  
  admin: {
    name: 'admin',
    inherits: ['manager'],
    permissions: [
      { resource: '*', action: 'create' },
      { resource: '*', action: 'read' },
      { resource: '*', action: 'update' },
      { resource: '*', action: 'delete' },
      { resource: '*', action: 'manage' }
    ]
  }
};

export const usePermissions = () => {
  const { profile } = useAuth();
  
  const hasPermission = useCallback((
    resource: string,
    action: string,
    context?: Record<string, any>
  ): boolean => {
    if (!profile) return false;
    
    const userRole = ROLE_DEFINITIONS[profile.role];
    if (!userRole) return false;
    
    // ìƒì†ëœ ê¶Œí•œ í¬í•¨í•˜ì—¬ ëª¨ë“  ê¶Œí•œ ìˆ˜ì§‘
    const allPermissions = collectPermissions(userRole);
    
    // í•´ë‹¹ ë¦¬ì†ŒìŠ¤ì™€ ì•¡ì…˜ì— ëŒ€í•œ ê¶Œí•œ ì°¾ê¸°
    const matchingPermissions = allPermissions.filter(permission => 
      (permission.resource === resource || permission.resource === '*') &&
      (permission.action === action || permission.action === 'manage')
    );
    
    if (matchingPermissions.length === 0) return false;
    
    // ì¡°ê±´ë¶€ ê¶Œí•œ ê²€ì‚¬
    for (const permission of matchingPermissions) {
      if (!permission.conditions) return true; // ë¬´ì¡°ê±´ í—ˆìš©
      
      const conditionsMet = permission.conditions.every(condition => 
        evaluateCondition(condition, context, profile)
      );
      
      if (conditionsMet) return true;
    }
    
    return false;
  }, [profile]);
  
  const canAccess = useCallback((route: string): boolean => {
    const routePermissions: Record<string, { resource: string; action: string }> = {
      '/admin': { resource: 'admin', action: 'read' },
      '/admin/users': { resource: 'users', action: 'manage' },
      '/admin/audit': { resource: 'audit_logs', action: 'read' },
      '/reports': { resource: 'reports', action: 'read' },
      '/projects/new': { resource: 'projects', action: 'create' }
    };
    
    const required = routePermissions[route];
    if (!required) return true; // ì œí•œ ì—†ëŠ” ë¼ìš°íŠ¸
    
    return hasPermission(required.resource, required.action);
  }, [hasPermission]);
  
  const getProjectPermissions = useCallback((project: Project) => {
    if (!profile) return {
      canView: false,
      canEdit: false,
      canDelete: false,
      canManageCollaborators: false
    };
    
    const isOwner = project.created_by === profile.id;
    const isAdmin = profile.role === 'admin';
    const isManager = profile.role === 'manager';
    
    // í˜‘ì—…ì ê¶Œí•œ í™•ì¸ (ì‹¤ì œë¡œëŠ” DBì—ì„œ ì¡°íšŒ)
    const collaboratorRole = getCollaboratorRole(project.id, profile.id);
    
    return {
      canView: hasPermission('projects', 'read', { project_id: project.id }),
      canEdit: isOwner || isAdmin || collaboratorRole === 'editor',
      canDelete: isOwner || isAdmin,
      canManageCollaborators: isOwner || isAdmin,
      canComment: hasPermission('opinions', 'create', { project_id: project.id })
    };
  }, [profile, hasPermission]);
  
  return {
    hasPermission,
    canAccess,
    getProjectPermissions,
    userRole: profile?.role,
    isAdmin: profile?.role === 'admin',
    isManager: ['admin', 'manager'].includes(profile?.role || '')
  };
};

// ë³´ì¡° í•¨ìˆ˜ë“¤
const collectPermissions = (role: Role): Permission[] => {
  let permissions = [...role.permissions];
  
  if (role.inherits) {
    for (const inheritedRoleName of role.inherits) {
      const inheritedRole = ROLE_DEFINITIONS[inheritedRoleName];
      if (inheritedRole) {
        permissions = [...permissions, ...collectPermissions(inheritedRole)];
      }
    }
  }
  
  return permissions;
};

const evaluateCondition = (
  condition: PermissionCondition,
  context: Record<string, any> = {},
  profile: Profile
): boolean => {
  let contextValue = context[condition.field];
  
  // íŠ¹ìˆ˜ ê°’ ì²˜ë¦¬
  if (condition.value === 'current_user') {
    condition.value = profile.id;
  }
  
  switch (condition.operator) {
    case 'eq':
      return contextValue === condition.value;
    case 'ne':
      return contextValue !== condition.value;
    case 'in':
      return Array.isArray(condition.value) && condition.value.includes(contextValue);
    case 'not_in':
      return Array.isArray(condition.value) && !condition.value.includes(contextValue);
    case 'gt':
      return contextValue > condition.value;
    case 'lt':
      return contextValue < condition.value;
    default:
      return false;
  }
};

// í˜‘ì—…ì ì—­í•  ì¡°íšŒ (ìºì‹œë¨)
const collaboratorRoleCache = new Map<string, string>();

const getCollaboratorRole = (projectId: string, userId: string): string | null => {
  const cacheKey = `${projectId}:${userId}`;
  return collaboratorRoleCache.get(cacheKey) || null;
};
```

---

## âš¡ ì‹¤ì‹œê°„ ê¸°ëŠ¥

### ê³ ë„í™”ëœ ì‹¤ì‹œê°„ ì‹œìŠ¤í…œ

#### ì—°ê²° ìƒíƒœ ëª¨ë‹ˆí„°ë§ ë° ìë™ ë³µêµ¬
```typescript
// src/hooks/useConnectionStatus.ts
interface ConnectionStatus {
  isOnline: boolean;
  supabaseConnected: boolean;
  lastDisconnectTime?: Date;
  reconnectAttempts: number;
  connectionQuality: 'excellent' | 'good' | 'poor' | 'disconnected';
}

export const useConnectionStatus = () => {
  const [status, setStatus] = useState<ConnectionStatus>({
    isOnline: navigator.onLine,
    supabaseConnected: true,
    reconnectAttempts: 0,
    connectionQuality: 'excellent'
  });
  
  const [reconnectTimer, setReconnectTimer] = useState<NodeJS.Timeout | null>(null);
  
  // ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ëª¨ë‹ˆí„°ë§
  useEffect(() => {
    const handleOnline = () => {
      setStatus(prev => ({ ...prev, isOnline: true }));
      // ì˜¨ë¼ì¸ ë³µê·€ ì‹œ Supabase ì—°ê²° ìƒíƒœ í™•ì¸
      checkSupabaseConnection();
    };
    
    const handleOffline = () => {
      setStatus(prev => ({ 
        ...prev, 
        isOnline: false,
        lastDisconnectTime: new Date(),
        connectionQuality: 'disconnected'
      }));
    };
    
    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);
    
    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  }, []);
  
  // Supabase ì—°ê²° ìƒíƒœ ì •ê¸° ì²´í¬
  const checkSupabaseConnection = useCallback(async () => {
    try {
      const startTime = Date.now();
      
      // ê°„ë‹¨í•œ ì¿¼ë¦¬ë¡œ ì—°ê²° ìƒíƒœ í™•ì¸
      const { error } = await supabase
        .from('profiles')
        .select('count')
        .limit(1)
        .single();
      
      const responseTime = Date.now() - startTime;
      
      if (!error) {
        // ì—°ê²° í’ˆì§ˆ í‰ê°€
        let quality: ConnectionStatus['connectionQuality'];
        if (responseTime < 100) quality = 'excellent';
        else if (responseTime < 500) quality = 'good';
        else if (responseTime < 2000) quality = 'poor';
        else quality = 'disconnected';
        
        setStatus(prev => ({
          ...prev,
          supabaseConnected: true,
          reconnectAttempts: 0,
          connectionQuality: quality
        }));
      } else {
        throw error;
      }
    } catch (error) {
      console.error('Supabase connection check failed:', error);
      
      setStatus(prev => ({
        ...prev,
        supabaseConnected: false,
        connectionQuality: 'disconnected'
      }));
      
      // ìë™ ì¬ì—°ê²° ì‹œë„
      scheduleReconnection();
    }
  }, []);
  
  // ì¬ì—°ê²° ìŠ¤ì¼€ì¤„ë§
  const scheduleReconnection = useCallback(() => {
    if (reconnectTimer) clearTimeout(reconnectTimer);
    
    setStatus(prev => ({
      ...prev,
      reconnectAttempts: prev.reconnectAttempts + 1
    }));
    
    // ì§€ìˆ˜ì  ë°±ì˜¤í”„ (1ì´ˆ, 2ì´ˆ, 4ì´ˆ, 8ì´ˆ, ìµœëŒ€ 30ì´ˆ)
    const delay = Math.min(1000 * Math.pow(2, status.reconnectAttempts), 30000);
    
    const timer = setTimeout(() => {
      checkSupabaseConnection();
    }, delay);
    
    setReconnectTimer(timer);
  }, [status.reconnectAttempts, checkSupabaseConnection]);
  
  // ì •ê¸°ì ì¸ ì—°ê²° ìƒíƒœ ì²´í¬
  useEffect(() => {
    const interval = setInterval(checkSupabaseConnection, 30000); // 30ì´ˆë§ˆë‹¤
    
    // ì´ˆê¸° ì²´í¬
    checkSupabaseConnection();
    
    return () => {
      clearInterval(interval);
      if (reconnectTimer) clearTimeout(reconnectTimer);
    };
  }, [checkSupabaseConnection]);
  
  return {
    ...status,
    forceReconnect: checkSupabaseConnection
  };
};
```

#### ìµœì í™”ëœ ì‹¤ì‹œê°„ êµ¬ë… ì‹œìŠ¤í…œ
```typescript
// src/hooks/useRealtimeSubscription.ts
interface SubscriptionOptions {
  filter?: string;
  enabled?: boolean;
  onConnect?: () => void;
  onDisconnect?: () => void;
  onError?: (error: any) => void;
  throttleMs?: number;
}

interface SubscriptionManager {
  subscribe: (options?: SubscriptionOptions) => void;
  unsubscribe: () => void;
  isSubscribed: boolean;
  connectionStatus: 'connecting' | 'connected' | 'disconnected' | 'error';
}

export const useRealtimeSubscription = (
  table: string,
  callback: (payload: any) => void,
  dependencies: any[] = []
): SubscriptionManager => {
  const [isSubscribed, setIsSubscribed] = useState(false);
  const [connectionStatus, setConnectionStatus] = useState<'connecting' | 'connected' | 'disconnected' | 'error'>('disconnected');
  const subscriptionRef = useRef<any>(null);
  const throttledCallbackRef = useRef<any>(null);
  
  const { supabaseConnected } = useConnectionStatus();
  
  const subscribe = useCallback((options: SubscriptionOptions = {}) => {
    if (subscriptionRef.current || !supabaseConnected) return;
    
    setConnectionStatus('connecting');
    
    // ìŠ¤ë¡œí‹€ë§ ì ìš©
    const throttleMs = options.throttleMs || 100;
    throttledCallbackRef.current = throttle((payload: any) => {
      callback(payload);
    }, throttleMs);
    
    const channelName = `${table}-${Date.now()}`;
    const channel = supabase.channel(channelName);
    
    // PostgreSQL ë³€ê²½ ì‚¬í•­ êµ¬ë…
    channel.on(
      'postgres_changes',
      {
        event: '*',
        schema: 'public',
        table: table,
        filter: options.filter
      },
      (payload) => {
        console.log(`Realtime update for ${table}:`, payload);
        throttledCallbackRef.current(payload);
      }
    )
    .subscribe((status) => {
      console.log(`Subscription status for ${table}:`, status);
      
      if (status === 'SUBSCRIBED') {
        setConnectionStatus('connected');
        setIsSubscribed(true);
        options.onConnect?.();
      } else if (status === 'CHANNEL_ERROR') {
        setConnectionStatus('error');
        setIsSubscribed(false);
        options.onError?.(new Error('Channel subscription failed'));
      } else if (status === 'CLOSED') {
        setConnectionStatus('disconnected');
        setIsSubscribed(false);
        options.onDisconnect?.();
      }
    });
    
    subscriptionRef.current = channel;
  }, [table, callback, supabaseConnected]);
  
  const unsubscribe = useCallback(() => {
    if (subscriptionRef.current) {
      subscriptionRef.current.unsubscribe();
      subscriptionRef.current = null;
      setIsSubscribed(false);
      setConnectionStatus('disconnected');
    }
  }, []);
  
  // ì˜ì¡´ì„± ë³€ê²½ ì‹œ ì¬êµ¬ë…
  useEffect(() => {
    unsubscribe();
    if (supabaseConnected) {
      subscribe();
    }
    
    return unsubscribe;
  }, [supabaseConnected, ...dependencies]);
  
  return {
    subscribe,
    unsubscribe,
    isSubscribed,
    connectionStatus
  };
};
```

#### í˜‘ì—… ì¶©ëŒ ë°©ì§€ ì‹œìŠ¤í…œ
```typescript
// src/hooks/useCollaborativeEditing.ts
interface EditingUser {
  userId: string;
  userName: string;
  field: string;
  startedAt: Date;
  cursorPosition?: number;
}

interface CollaborativeState {
  isEditing: boolean;
  editingUsers: EditingUser[];
  conflictWarnings: string[];
  lockOwner?: string;
}

export const useCollaborativeEditing = (
  resourceType: 'project' | 'stage' | 'opinion',
  resourceId: string
) => {
  const [state, setState] = useState<CollaborativeState>({
    isEditing: false,
    editingUsers: [],
    conflictWarnings: []
  });
  
  const { user } = useAuth();
  const channelRef = useRef<any>(null);
  const heartbeatIntervalRef = useRef<NodeJS.Timeout | null>(null);
  
  // í¸ì§‘ ì„¸ì…˜ ì‹œì‘
  const startEditing = useCallback(async (fieldKey: string, lockDuration?: number) => {
    if (!user || state.isEditing) return false;
    
    try {
      // ë‚™ê´€ì  ì ê¸ˆ ì‹œë„
      const { data: lockResult, error } = await supabase.rpc('acquire_edit_lock', {
        resource_type: resourceType,
        resource_id: resourceId,
        field_key: fieldKey,
        user_id: user.id,
        lock_duration: lockDuration || 300 // 5ë¶„ ê¸°ë³¸ê°’
      });
      
      if (error || !lockResult.success) {
        setState(prev => ({
          ...prev,
          conflictWarnings: [
            ...prev.conflictWarnings,
            `${lockResult.current_editor}ë‹˜ì´ ì´ë¯¸ í¸ì§‘ ì¤‘ì…ë‹ˆë‹¤.`
          ]
        }));
        return false;
      }
      
      // í¸ì§‘ ìƒíƒœ ë¸Œë¡œë“œìºìŠ¤íŠ¸
      if (!channelRef.current) {
        channelRef.current = supabase.channel(`editing:${resourceType}:${resourceId}`);
        
        channelRef.current
          .on('broadcast', { event: 'editing-started' }, (payload: any) => {
            setState(prev => ({
              ...prev,
              editingUsers: [
                ...prev.editingUsers.filter(u => u.userId !== payload.userId),
                {
                  userId: payload.userId,
                  userName: payload.userName,
                  field: payload.field,
                  startedAt: new Date(payload.startedAt)
                }
              ]
            }));
          })
          .on('broadcast', { event: 'editing-stopped' }, (payload: any) => {
            setState(prev => ({
              ...prev,
              editingUsers: prev.editingUsers.filter(u => u.userId !== payload.userId)
            }));
          })
          .on('broadcast', { event: 'cursor-moved' }, (payload: any) => {
            setState(prev => ({
              ...prev,
              editingUsers: prev.editingUsers.map(u => 
                u.userId === payload.userId 
                  ? { ...u, cursorPosition: payload.position }
                  : u
              )
            }));
          })
          .subscribe();
      }
      
      // í¸ì§‘ ì‹œì‘ ì•Œë¦¼
      channelRef.current.send({
        type: 'broadcast',
        event: 'editing-started',
        payload: {
          userId: user.id,
          userName: user.user_metadata?.name || user.email,
          field: fieldKey,
          startedAt: new Date().toISOString()
        }
      });
      
      // í•˜íŠ¸ë¹„íŠ¸ ì‹œì‘ (í¸ì§‘ ì„¸ì…˜ ìœ ì§€)
      heartbeatIntervalRef.current = setInterval(async () => {
        await supabase.rpc('extend_edit_lock', {
          resource_type: resourceType,
          resource_id: resourceId,
          field_key: fieldKey,
          user_id: user.id
        });
      }, 60000); // 1ë¶„ë§ˆë‹¤
      
      setState(prev => ({
        ...prev,
        isEditing: true,
        lockOwner: user.id
      }));
      
      return true;
    } catch (error) {
      console.error('Failed to start editing:', error);
      return false;
    }
  }, [user, resourceType, resourceId, state.isEditing]);
  
  // í¸ì§‘ ì¢…ë£Œ
  const stopEditing = useCallback(async (fieldKey: string) => {
    if (!user || !state.isEditing) return;
    
    try {
      // ì ê¸ˆ í•´ì œ
      await supabase.rpc('release_edit_lock', {
        resource_type: resourceType,
        resource_id: resourceId,
        field_key: fieldKey,
        user_id: user.id
      });
      
      // í¸ì§‘ ì¢…ë£Œ ì•Œë¦¼
      if (channelRef.current) {
        channelRef.current.send({
          type: 'broadcast',
          event: 'editing-stopped',
          payload: { userId: user.id }
        });
      }
      
      // í•˜íŠ¸ë¹„íŠ¸ ì¤‘ì§€
      if (heartbeatIntervalRef.current) {
        clearInterval(heartbeatIntervalRef.current);
        heartbeatIntervalRef.current = null;
      }
      
      setState(prev => ({
        ...prev,
        isEditing: false,
        lockOwner: undefined
      }));
    } catch (error) {
      console.error('Failed to stop editing:', error);
    }
  }, [user, resourceType, resourceId, state.isEditing]);
  
  // ì»¤ì„œ ìœ„ì¹˜ ê³µìœ 
  const updateCursorPosition = useCallback((position: number) => {
    if (channelRef.current && state.isEditing) {
      channelRef.current.send({
        type: 'broadcast',
        event: 'cursor-moved',
        payload: {
          userId: user?.id,
          position
        }
      });
    }
  }, [user, state.isEditing]);
  
  // ì •ë¦¬
  useEffect(() => {
    return () => {
      if (channelRef.current) {
        channelRef.current.unsubscribe();
      }
      if (heartbeatIntervalRef.current) {
        clearInterval(heartbeatIntervalRef.current);
      }
    };
  }, []);
  
  return {
    ...state,
    startEditing,
    stopEditing,
    updateCursorPosition,
    canEdit: !state.lockOwner || state.lockOwner === user?.id
  };
};
```

---

## ğŸš€ ì„±ëŠ¥ ìµœì í™”

### ë©”ëª¨ë¦¬ ë° ë Œë”ë§ ìµœì í™”

#### ì§€ëŠ¥í˜• ìºì‹± ì‹œìŠ¤í…œ
```typescript
// src/lib/cacheManager.ts
interface CacheEntry<T> {
  data: T;
  timestamp: number;
  expiry: number;
  version: string;
  dependencies: string[];
}

interface CacheConfig {
  defaultTTL: number; // ê¸°ë³¸ ë§Œë£Œ ì‹œê°„ (ms)
  maxSize: number; // ìµœëŒ€ ìºì‹œ í¬ê¸°
  persistToIndexedDB: boolean;
  compressionEnabled: boolean;
}

class IntelligentCacheManager {
  private cache = new Map<string, CacheEntry<any>>();
  private accessTimes = new Map<string, number>();
  private config: CacheConfig;
  
  constructor(config: Partial<CacheConfig> = {}) {
    this.config = {
      defaultTTL: 5 * 60 * 1000, // 5ë¶„
      maxSize: 1000,
      persistToIndexedDB: true,
      compressionEnabled: true,
      ...config
    };
    
    // ì£¼ê¸°ì  ì •ë¦¬
    setInterval(() => this.cleanup(), 60000); // 1ë¶„ë§ˆë‹¤
  }
  
  async set<T>(
    key: string, 
    data: T, 
    options: {
      ttl?: number;
      dependencies?: string[];
      version?: string;
      priority?: 'low' | 'medium' | 'high';
    } = {}
  ): Promise<void> {
    const entry: CacheEntry<T> = {
      data,
      timestamp: Date.now(),
      expiry: Date.now() + (options.ttl || this.config.defaultTTL),
      version: options.version || '1.0',
      dependencies: options.dependencies || []
    };
    
    // ìºì‹œ í¬ê¸° ì œí•œ í™•ì¸
    if (this.cache.size >= this.config.maxSize) {
      await this.evictLRU();
    }
    
    this.cache.set(key, entry);
    this.accessTimes.set(key, Date.now());
    
    // IndexedDBì— ì§€ì†í™”
    if (this.config.persistToIndexedDB && options.priority !== 'low') {
      await this.persistToIndexedDB(key, entry);
    }
  }
  
  async get<T>(key: string): Promise<T | null> {
    const entry = this.cache.get(key);
    
    if (!entry) {
      // IndexedDBì—ì„œ ë³µì› ì‹œë„
      if (this.config.persistToIndexedDB) {
        const restored = await this.restoreFromIndexedDB<T>(key);
        if (restored) {
          this.cache.set(key, restored);
          return restored.data;
        }
      }
      return null;
    }
    
    // ë§Œë£Œ í™•ì¸
    if (Date.now() > entry.expiry) {
      this.cache.delete(key);
      this.accessTimes.delete(key);
      return null;
    }
    
    // ì˜ì¡´ì„± í™•ì¸
    if (entry.dependencies.length > 0) {
      const dependenciesValid = await this.validateDependencies(entry.dependencies);
      if (!dependenciesValid) {
        this.cache.delete(key);
        return null;
      }
    }
    
    // ì•¡ì„¸ìŠ¤ ì‹œê°„ ì—…ë°ì´íŠ¸
    this.accessTimes.set(key, Date.now());
    
    return entry.data;
  }
  
  invalidate(pattern: string | string[]): void {
    const patterns = Array.isArray(pattern) ? pattern : [pattern];
    
    for (const [key] of this.cache) {
      if (patterns.some(p => key.includes(p))) {
        this.cache.delete(key);
        this.accessTimes.delete(key);
      }
    }
  }
  
  private async evictLRU(): Promise<void> {
    // LRU ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ìºì‹œ í•­ëª© ì œê±°
    let oldestKey = '';
    let oldestTime = Date.now();
    
    for (const [key, time] of this.accessTimes) {
      if (time < oldestTime) {
        oldestTime = time;
        oldestKey = key;
      }
    }
    
    if (oldestKey) {
      this.cache.delete(oldestKey);
      this.accessTimes.delete(oldestKey);
    }
  }
  
  private async validateDependencies(dependencies: string[]): Promise<boolean> {
    // ì˜ì¡´ì„± ê²€ì¦ ë¡œì§ (ì˜ˆ: ë‹¤ë¥¸ ìºì‹œ í‚¤ì˜ ë²„ì „ í™•ì¸)
    for (const dep of dependencies) {
      const depEntry = this.cache.get(dep);
      if (!depEntry || Date.now() > depEntry.expiry) {
        return false;
      }
    }
    return true;
  }
  
  private async persistToIndexedDB<T>(key: string, entry: CacheEntry<T>): Promise<void> {
    try {
      const db = await openIndexedDB();
      const transaction = db.transaction(['cache'], 'readwrite');
      const store = transaction.objectStore('cache');
      
      let dataToStore = entry;
      
      // ì••ì¶• ì ìš©
      if (this.config.compressionEnabled) {
        dataToStore = {
          ...entry,
          data: await this.compress(JSON.stringify(entry.data))
        };
      }
      
      await store.put({ key, ...dataToStore });
    } catch (error) {
      console.warn('Failed to persist to IndexedDB:', error);
    }
  }
  
  private async restoreFromIndexedDB<T>(key: string): Promise<CacheEntry<T> | null> {
    try {
      const db = await openIndexedDB();
      const transaction = db.transaction(['cache'], 'readonly');
      const store = transaction.objectStore('cache');
      const result = await store.get(key);
      
      if (!result) return null;
      
      // ì••ì¶• í•´ì œ
      if (this.config.compressionEnabled && typeof result.data === 'string') {
        result.data = JSON.parse(await this.decompress(result.data));
      }
      
      return result;
    } catch (error) {
      console.warn('Failed to restore from IndexedDB:', error);
      return null;
    }
  }
  
  private async compress(data: string): Promise<string> {
    // ê°„ë‹¨í•œ ì••ì¶• ë¡œì§ (ì‹¤ì œë¡œëŠ” ë” ê³ ë„í™”ëœ ì••ì¶• ì•Œê³ ë¦¬ì¦˜ ì‚¬ìš©)
    return btoa(data);
  }
  
  private async decompress(data: string): Promise<string> {
    return atob(data);
  }
  
  private cleanup(): void {
    const now = Date.now();
    
    for (const [key, entry] of this.cache) {
      if (now > entry.expiry) {
        this.cache.delete(key);
        this.accessTimes.delete(key);
      }
    }
  }
  
  getStats() {
    return {
      size: this.cache.size,
      maxSize: this.config.maxSize,
      hitRate: this.calculateHitRate(),
      memoryUsage: this.estimateMemoryUsage()
    };
  }
  
  private calculateHitRate(): number {
    // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” íˆíŠ¸/ë¯¸ìŠ¤ ì¹´ìš´í„° í•„ìš”
    return 0.85; // ì˜ˆì‹œê°’
  }
  
  private estimateMemoryUsage(): number {
    // ëŒ€ëµì ì¸ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ê³„ì‚°
    let totalSize = 0;
    for (const [key, entry] of this.cache) {
      totalSize += JSON.stringify({ key, entry }).length * 2; // UTF-16
    }
    return totalSize;
  }
}

// ì „ì—­ ìºì‹œ ì¸ìŠ¤í„´ìŠ¤
export const cacheManager = new IntelligentCacheManager();

// React Queryì™€ í†µí•©
export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 5 * 60 * 1000, // 5ë¶„
      cacheTime: 10 * 60 * 1000, // 10ë¶„
      retry: (failureCount, error: any) => {
        // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ì•„ë‹Œ ê²½ìš° ì¬ì‹œë„ ì•ˆí•¨
        if (error?.status >= 400 && error?.status < 500) {
          return false;
        }
        return failureCount < 3;
      },
      retryDelay: (attemptIndex) => Math.min(1000 * 2 ** attemptIndex, 30000)